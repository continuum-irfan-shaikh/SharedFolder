{"id":"7b839537-5f9b-11e9-8699-00155d130b01","partnerId":"00000000-0000-0000-0000-000000000000","category":["Data Collection"],"description":"Captures screenshot of the desktop if user is loggedon","engine":"powershell","engineMaxVersion":5,"expectedExecutionTimeSec":300,"failureMessage":"Executed with errors","successMessage":"Excecuted successfully","internal":false,"name":"Capture screenshot","tags":["Windows 7","Windows 10"],"sequence":true,"content":"IyAkRmlsZW5hbWUgPSAiJCgkZW52OkNPTVBVVEVSTkFNRSkuanBnIiAjIHN0cmluZwojICRUeXBlID0gJ25ldHdvcmsnICMgc3RyaW5nCiMgJFBhdGggPSAnXFwxMC4yLjE5LjI1XGUkXEFudGl2aXJ1cyBTZXR1cHNcUHJhdGVlaycgIyBzdHJpbmcKIyAkVXNlck5hbWUgPSAnYWRtaW5pc3RyYXRvcicgIyBzdHJpbmcKIyAkUGFzc3dvcmQgPSAnR3J0QDIwMTgnICMgc3RyaW5nCgppZiAoJGVudjpQUk9DRVNTT1JfQVJDSElURVc2NDMyIC1lcSAiQU1ENjQiKSB7CiAgICBpZiAoJG15SW52b2NhdGlvbi5MaW5lKSB7CiAgICAgICAgJiIkZW52OnN5c3RlbXJvb3Rcc3lzbmF0aXZlXHdpbmRvd3Nwb3dlcnNoZWxsXHYxLjBccG93ZXJzaGVsbC5leGUiIC1Ob25JbnRlcmFjdGl2ZSAtTm9Qcm9maWxlICRteUludm9jYXRpb24uTGluZQogICAgfQogICAgZWxzZSB7CiAgICAgICAgJiIkZW52OnN5c3RlbXJvb3Rcc3lzbmF0aXZlXHdpbmRvd3Nwb3dlcnNoZWxsXHYxLjBccG93ZXJzaGVsbC5leGUiIC1Ob25JbnRlcmFjdGl2ZSAtTm9Qcm9maWxlIC1maWxlICIkKCRteUludm9jYXRpb24uSW52b2NhdGlvbk5hbWUpIiAkYXJncwogICAgfQogICAgZXhpdCAkbGFzdGV4aXRjb2RlCn0KCkZ1bmN0aW9uIEdldC1SRFBTZXNzaW9ucyB7CiAgICB0cnkgewogICAgICAgICRFcnJvckFjdGlvblByZWZlcmVuY2UgPSAnU3RvcCcKICAgICAgICBpZiAoJGVudjpQUk9DRVNTT1JfQVJDSElURVc2NDMyIC1lcSAiQU1ENjQiIC1hbmQgJGVudjpQUk9DRVNTT1JfQVJDSElURUNUVVJFIC1lcSAneDg2JykgeyAkUXVlcnkgPSAnYzpcd2luZG93c1xzeXNuYXRpdmVccXVlcnkuZXhlJyB9ZWxzZSB7ICRRdWVyeSA9ICdjOlx3aW5kb3dzXFN5c3RlbTMyXHF1ZXJ5LmV4ZScgfQogICAgICAgICRMb2dnZWRPblVzZXJzID0gaWYgKCgkVXNlcnMgPSAoJiAkUXVlcnkgdXNlciAyPiYxKSkpIHsKICAgICAgICAgICAgJFVzZXJzIHwgRm9yRWFjaC1PYmplY3QgeyAoKCRfLnRyaW0oKSAtcmVwbGFjZSAiPiIgLXJlcGxhY2UgIig/bSleKFtBLVphLXowLTldezMsfSlccysoXGR7MSwyfVxzK1x3KykiLCAnJDEgIG5vbmUgICQyJyAtcmVwbGFjZSAiXHN7Mix9IiwgIiwiIC1yZXBsYWNlICJub25lIiwgJG51bGwpKSB9IHwKICAgICAgICAgICAgQ29udmVydEZyb20tQ3N2IHwKICAgICAgICAgICAgV2hlcmUtT2JqZWN0IHsgJF8uc3RhdGUgLWVxICdBY3RpdmUnIH0gIy1hbmQgJF8uU0VTU0lPTk5BTUUgLWxpa2UgInJkcCoiIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRMb2dnZWRPblVzZXJzCiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgIyBubyBhY3Rpb24KICAgIH0KfQoKRnVuY3Rpb24gQXBwZW5kVG9DU1YgKCRUeXBlLCAkTWVzc2FnZSkgewogICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgcHNvYmplY3QgLVByb3BlcnR5IEB7VHlwZSA9ICRUeXBlOyBNZXNzYWdlID0gJE1lc3NhZ2UgfSB8IENvbnZlcnRUby1Dc3YgLU5vVHlwZUluZm9ybWF0aW9uIHwgU2VsZWN0LU9iamVjdCAtU2tpcCAxIHwgT3V0LUZpbGUgQzpcdGVtcFxsb2cuY3N2IC1BcHBlbmQKfQoKCiRTY3JpcHRibG9jayA9IHsKCiAgICBGdW5jdGlvbiBBcHBlbmRUb0NTViAoJFR5cGUsICRNZXNzYWdlKSB7CiAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgcHNvYmplY3QgLVByb3BlcnR5IEB7VHlwZSA9ICRUeXBlOyBNZXNzYWdlID0gJE1lc3NhZ2UgfSB8IENvbnZlcnRUby1Dc3YgLU5vVHlwZUluZm9ybWF0aW9uIHwgU2VsZWN0LU9iamVjdCAtU2tpcCAxIHwgT3V0LUZpbGUgQzpcdGVtcFxsb2cuY3N2IC1BcHBlbmQKICAgIH0KCiAgICB0cnkgewogICAgICAgICRFcnJvckFjdGlvblByZWZlcmVuY2UgPSAnU3RvcCcKICAgICAgICAkRXh0ZW5zaW9uID0gW0lPLlBhdGhdOjpHZXRFeHRlbnNpb24oJEZpbGVOYW1lKQogICAgICAgIGlmICghKCRFeHRlbnNpb24gLWVxICcuanBnJyAtb3IgJEV4dGVuc2lvbiAtZXEgJy5qcGVnJykpIHsgV3JpdGUtRXJyb3IgIkZpbGUgZXh0ZW5zaW9uIG11c3QgYmUgYCcuanBnYCciIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICBbU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHldOjpMb2FkV2l0aFBhcnRpYWxOYW1lKCJTeXN0ZW0uRHJhd2luZyIpIHwgT3V0LU51bGwgIyBsb2FkIGFzc2VtYmxpZXMKICAgICAgICBbU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHldOjpMb2FkV2l0aFBhcnRpYWxOYW1lKCJTeXN0ZW0uV2luZG93cy5Gb3JtcyIpIHwgT3V0LU51bGwKICAgICAgICAkU2NyZWVuID0gW1N5c3RlbS5XaW5kb3dzLkZvcm1zLlNjcmVlbl06OlByaW1hcnlTY3JlZW4uQm91bmRzCiAgICAgICAgJEJpdG1hcCA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuQml0bWFwICRTY3JlZW4ud2lkdGgsICRTY3JlZW4uaGVpZ2h0CiAgICAgICAgJFNpemUgPSBOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLlNpemUgJFNjcmVlbi53aWR0aCwgJFNjcmVlbi5oZWlnaHQKICAgICAgICAkRnJvbUltYWdlID0gW1N5c3RlbS5EcmF3aW5nLkdyYXBoaWNzXTo6RnJvbUltYWdlKCRCaXRtYXApCiAgICAgICAgJEZyb21JbWFnZS5jb3B5ZnJvbXNjcmVlbigwLCAwLCAwLCAwLCAkU2l6ZSwgKFtTeXN0ZW0uRHJhd2luZy5Db3B5UGl4ZWxPcGVyYXRpb25dOjpTb3VyY2VDb3B5KSkKICAgICAgICAKICAgICAgICAkVGVtcExvYyA9ICdDOlxUZW1wXCcKICAgICAgICAKICAgICAgICBzd2l0Y2ggKCR0eXBlKSB7CiAgICAgICAgICAgICdsb2NhbCcgewogICAgICAgICAgICAgICAgJFRlbXBUYXJnZXQgPSBKb2luLVBhdGggJFRlbXBMb2MgJEZpbGVOYW1lCiAgICAgICAgICAgICAgICAkVGFyZ2V0ID0gSm9pbi1QYXRoICRQYXRoICRGaWxlTmFtZQogICAgICAgICAgICAgICAgaWYgKCFbSU8uRGlyZWN0b3J5XTo6RXhpc3RzKCRQYXRoKSkgeyBbSU8uRGlyZWN0b3J5XTo6Q3JlYXRlRGlyZWN0b3J5KCRQYXRoKSB8IE91dC1OdWxsIH0gIyBjcmVhdGUgZm9sZGVyIGlmIHRoYXQgZG9lc24ndCBleGlzdHMKICAgICAgICAgICAgICAgICRCaXRtYXAuU2F2ZSgiJFRlbXBUYXJnZXQiLCAoW3N5c3RlbS5kcmF3aW5nLmltYWdpbmcuaW1hZ2Vmb3JtYXRdOjpKcGVnKSkKICAgICAgICAgICAgfQogICAgICAgICAgICAnbmV0d29yaycgewogICAgICAgICAgICAgICAgJERyaXZlTGV0dGVyID0gR2V0LUNoaWxkSXRlbSBmdW5jdGlvbjpbZy16XTogLW4gfCBXaGVyZS1PYmplY3QgeyAhKFRlc3QtUGF0aCAkXykgfSB8IEdldC1SYW5kb20KICAgICAgICAgICAgICAgICROZXR3b3JrID0gTmV3LU9iamVjdCAtQ29tT2JqZWN0IFdTY3JpcHQuTmV0d29yawogICAgICAgICAgICAgICAgJE5ldHdvcmsuTWFwTmV0d29ya0RyaXZlKCREcml2ZUxldHRlciwgIiRQYXRoIiwgJGZhbHNlLCAkVXNlck5hbWUsICRQYXNzd29yZCkgCiAgICAgICAgICAgICAgICBTdGFydC1TbGVlcCAtcyA0CiAgICAgICAgICAgICAgICBpZiAoVGVzdC1QYXRoICIkRHJpdmVMZXR0ZXJcIikgewogICAgICAgICAgICAgICAgICAgICRUYXJnZXQgPSBKb2luLVBhdGggJERyaXZlTGV0dGVyICRGaWxlTmFtZQogICAgICAgICAgICAgICAgICAgICRCaXRtYXAuU2F2ZSgkVGFyZ2V0LCAoW3N5c3RlbS5kcmF3aW5nLmltYWdpbmcuaW1hZ2Vmb3JtYXRdOjpKcGVnKSkKICAgICAgICAgICAgICAgIH0gICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGNhdGNoIHsgIEFwcGVuZFRvQ1NWICJPdXRwdXQiICJFcnJvcjogJCgkXy5leGNlcHRpb24ubWVzc2FnZSkiIH0KICAgIGZpbmFsbHkgewogICAgICAgIHRyeSB7ICROZXR3b3JrLlJlbW92ZU5ldHdvcmtEcml2ZSgkRHJpdmVMZXR0ZXIsICRUcnVlKSB9Y2F0Y2ggeyB9CiAgICB9Cgp9CgokZmlsZSA9IEAiCmAkRmlsZW5hbWUgPSAiJEZpbGVOYW1lIgpgJFR5cGUgPSAiJFR5cGUiCmAkUGF0aCA9ICIkUGF0aCIKYCRVc2VyTmFtZSA9ICIkVXNlcm5hbWUiCmAkUGFzc3dvcmQgPSAiJFBhc3N3b3JkIgoiQCArICRTY3JpcHRibG9jay5Ub1N0cmluZygpCgokRXJyb3JBY3Rpb25QcmVmZXJlbmNlID0gJ1N0b3AnCiRMb2dEaXIgPSAnQzpcdGVtcFwnCiRMb2dGaWxlUGF0aCA9ICdDOlx0ZW1wXExvZy5jc3YnCiRNYWluRmlsZVBhdGggPSAnQzpcdGVtcFxDYXB0dXJlU2NyZWVuc2hvdC5wczEnCiRUYXNrTmFtZSA9ICJDYXB0dXJlU2NyZWVuIgoKaWYgKCFbSU8uRGlyZWN0b3J5XTo6RXhpc3RzKCRMb2dEaXIpKSB7IFtJTy5EaXJlY3RvcnldOjpDcmVhdGVEaXJlY3RvcnkoJExvZ0RpcikgfCBPdXQtTnVsbCB9ICMgY3JlYXRlIGZvbGRlciBpZiB0aGF0IGRvZXNuJ3QgZXhpc3RzCiRGaWxlIHwgT3V0LUZpbGUgJE1haW5GaWxlUGF0aCAtRW5jb2RpbmcgdXRmOCAjIGNvcHkgbWFpbiBzY3JpcHQgd2hpY2ggd2lsbCBiZSBsYXRlciBleGVjdXRlZCBmcm9tIHNjaGVkdWxlZCB0YXNrCgp0cnkgewogICAgaWYgKCgkU2Vzc2lvbiA9IEdldC1SRFBTZXNzaW9ucykpIHsKICAgICAgICAnIk1lc3NhZ2UiLCJUeXBlIicgfCBPdXQtRmlsZSAkTG9nRmlsZVBhdGggLUFwcGVuZAogICAgICAgICRVc2VyID0gJFNlc3Npb24gfCBTZWxlY3QtT2JqZWN0IC1GaXJzdCAxIC1FeHBhbmRQcm9wZXJ0eSBVc2VybmFtZSAjIHNlbGVjdCBvbmUgdXNlciBwcm9maWxlIGZyb20gYWN0aXZlIFJEUCBzZXNzaW9ucwogICAgICAgIAogICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzIDUKICAgICAgICAkVGFzayA9ICJQb3dlclNoZWxsLmV4ZSAtZXhlY3V0aW9ucG9saWN5IGJ5cGFzcyAtTm9FeGl0IC1ub3Byb2ZpbGUgLVdpbmRvd1N0eWxlIEhpZGRlbiAtY29tbWFuZCAnLiAkTWFpbkZpbGVQYXRoICciCiAgICAgICAgJFN0YXJ0VGltZSA9IChHZXQtRGF0ZSkuQWRkTWludXRlcygyKS5Ub1N0cmluZygnSEg6bW0nKSAjIHRpbWUgaW4gMjRociBmb3JtYXQKICAgICAgICAKICAgICAgICBzY2h0YXNrcy5leGUgL2NyZWF0ZSAvcyAkKCRlbnY6Q09NUFVURVJOQU1FKSAvdG4gJFRhc2tOYW1lIC9zYyBvbmNlIC90ciAkVGFzayAvc3QgJFN0YXJ0VGltZSAvcnUgJFVzZXIgL0YgfCBPdXQtTnVsbAogICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzIDUKCiAgICAgICAgc2NodGFza3MuZXhlIC9FbmQgL1ROICRUYXNrTmFtZSB8IE91dC1OdWxsCiAgICAgICAgc2NodGFza3MuZXhlIC9SdW4gL1ROICRUYXNrTmFtZSB8IE91dC1OdWxsCiAgICAgICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgMTIwCiAgICAgICAgCiAgICAgICAgJFRhcmdldCA9IEpvaW4tUGF0aCAkUGF0aCAkRmlsZW5hbWUKICAgICAgICBpZigkVHlwZSAtZXEgJ0xvY2FsJyl7CiAgICAgICAgICAgICRUZW1wVGFyZ2V0ID0gSm9pbi1QYXRoICdDOlxUZW1wXCcgJEZpbGVuYW1lCiAgICAgICAgICAgIENvcHktSXRlbSAkVGVtcFRhcmdldCAkVGFyZ2V0IC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgfSAgICAKICAgICAgICAKICAgICAgICBpZiAoVGVzdC1QYXRoICRUYXJnZXQpIHsgCiAgICAgICAgICAgIEFwcGVuZFRvQ1NWICJPdXRwdXQiICJTdWNjZXNzZnVsbHkgY2FwdHVyZWQgdGhlIHNjcmVlbnNob3QgYW5kIHNhdmVkIHRvIGxvY2F0aW9uOiAkKEpvaW4tUGF0aCAkUGF0aCAkRmlsZW5hbWUpIgogICAgICAgIH0KICAgICAgICBlbHNlIHsgCiAgICAgICAgICAgIEFwcGVuZFRvQ1NWICJPdXRwdXQiICJGYWlsZWQgdG8gY2FwdHVyZSB0aGUgc2NyZWVuc2hvdC4iCiAgICAgICAgfQoKICAgICAgICAjIFNlbmRpbmcgbG9ncyB0byBQb3dlclNoZWxsIE91dHB1dFxFcnJvciBzdHJlYW1zIHNvIHRoYXQgYWdlbnQgY2FuIGNhcHR1cmUgaXQKICAgICAgICBpZiAoVGVzdC1QYXRoICRMb2dGaWxlUGF0aCkgewogICAgICAgICAgICAkTG9ncyA9IEltcG9ydC1Dc3YgJExvZ0ZpbGVQYXRoCiAgICAgICAgICAgIGZvcmVhY2ggKCRpdGVtIGluICRMb2dzKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKCRpdGVtLnR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAnT3V0cHV0JyB7IFdyaXRlLU91dHB1dCAiYG4kKCRpdGVtLm1lc3NhZ2UpIiB9CiAgICAgICAgICAgICAgICAgICAgJ0Vycm9yJyB7IFdyaXRlLUVycm9yICJgbiQoJGl0ZW0ubWVzc2FnZSkiIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc2NodGFza3MuZXhlIC9EZWxldGUgL1ROICRUYXNrTmFtZSAvRiB8IE91dC1OdWxsICMgc2NoZWR1bGVkIHRhc2sgY2xlYW51cAogICAgICAgIFJlbW92ZS1JdGVtIC1QYXRoICRNYWluRmlsZVBhdGgsICRMb2dGaWxlUGF0aCwgJFRlbXBUYXJnZXQgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgIyBmaWxlIGNsZWFudXAKICAgIH0KICAgIGVsc2UgewogICAgICAgIFdyaXRlLU91dHB1dCAiVGhpcyBzY3JpcHQgcmVxdWlyZXMgbG9nb24gdXNlciBhbmQgY3VycmVudGx5IG5vIHVzZXIgaXMgbG9nZ2VkIGluLiBgbk5vIGFjdGlvbiB3aWxsIGJlIHBlcmZvcm1lZC4iOyBleGl0OwogICAgfQp9CmNhdGNoIHsKICAgIFdyaXRlLUVycm9yICRfCn0K","jsonSchema":{"additionalProperties":false,"dependencies":{"Type":{"oneOf":[{"properties":{"Type":{"enum":["network"]},"password":{"title":"Password","type":"string"},"userName":{"title":"User Name","type":"string"}},"required":["userName","password"]},{"properties":{"Type":{"enum":["local"]}}}]}},"patternProperties":{"^password$":{},"^userName$":{}},"properties":{"Filename":{"title":"Image File Name","type":"string"},"Path":{"title":"Path","type":"string"},"Type":{"enum":["local","network"],"enumNames":["Local","Network"],"title":"Store the Image File on:","type":"string"}},"required":["Filename","Type","Path"],"type":"object"},"uiSchema":{"Filename":{"classNames":"col-sm-6 sol-sm-offset-right-6","ui:help":"File extension .JPG"},"Path":{"classNames":"col-sm-6 sol-sm-offset-right-6","ui:help":"Eg. local c:\\, or Network \\\\sharename\\"},"Type":{"classNames":"col-sm-4 sol-sm-offset-right-8","ui:autofocus":true,"ui:placeholder":"Select store type"},"password":{"classNames":"col-sm-6","ui:widget":"password"},"ui:order":["Filename","Type","Path","userName","password"],"userName":{"classNames":"col-sm-6","validationSchema":{"notEmpty":"userName","required":["password"],"type":"requiredFieldsIfNotEmpty"}}},"isHDScript":false}