{"id":"a4cc7b4a-723e-11e9-87db-00155d130b01","partnerId":"00000000-0000-0000-0000-000000000000","category":["Security"],"description":"Configures exceptions for Windows firewall. Add/Delete Program and Add/Delete Port from Windows firewall settings","engine":"powershell","engineMaxVersion":5,"expectedExecutionTimeSec":300,"failureMessage":"Executed with errors","successMessage":"Excecuted successfully","internal":false,"name":"Configure Windows firewall exceptions","tags":["Windows 7","Windows 10"],"sequence":true,"content":"PCMKICAgICAgLlNjcmlwdCBOYW1lCiAgICAgIENvbmZpZ3VyZSBGaXJld2FsbCBFeGNlcHRpb25zLgogICAgICAuQXV0aG9yCiAgICAgIE5pcmF2IFNhY2hvcmEKICAgICAgLlJlcXVpcmVtZW50cwogICAgICBTY3JpcHQgc2hvdWxkIHJ1biB3aXRoIGhpZ2hlc3QgcHJpdmlsZWdlcy4KIz4KCjwjJHRhc2sgPSAiQ3JlYXRlIiAgICNDcmVhdGUvRGVsZXRlLgokZGlyZWN0aW9uID0gIkluYm91bmQiICNJbmJvdW5kL291dGJvdW5kICB0aGlzIHdpbGwgcmVxdWlyZWQgZm9yIGJvdGggYWN0aW9uLmlmIGRlbGV0aW9uIEluYm91bmQvb3V0Ym91bmQvQWxsCiRydWxldHlwZSA9ICJQb3J0IiAjUHJvZ3JhbS9Qb3J0LgokcHJvZ3JhbXBhdGggPSAiQzpcVXNlcnMiICN0aGlzIHdpbGwgYmUgcmFkaW8gYnV0dG9uIEFsbC9TcGVjaWZ5IHBhdGggb2YgLmV4ZSBmaWxlLgokYWN0aW9uID0gIkFsbG93IiAgI0FsbG93L0Jsb2NrCiRwcm9maWxlcyA9ICJEb21haW4iLCJQdWJsaWMiLCJQcml2YXRlIiMsIlByaXZhdGUiICNBbGwvRG9tYWluL1ByaXZhdGUvUHVibGljLgokcHJvdG9jb2wgPSAiVURQIiAjVENQL1VEUC4gICAgRm9yIERlbGV0aW9uIFRDUC9VRFAvQWxsCiRwb3J0bnVtYmVycyA9ICI2NTU5OTg3IiAjQWxsL3NwZWNpZmljIHBvcnRzLgokdGFza25hbWUgPSAiVGVzdDEyIiAgIyBOYW1lIG9mIHRoZSBydWxlLgokcmVtb3Rlc2NvcGUgPSAiMTAuMi4yLjIsMTAuMi4zLjQsMTAuMi4yLjg5LTEwLjIuMi45NSIKJGxvY2Fsc2NvcGUgPSAiMTAuMi4yLjYsMTAuMi4zLjQsMTAuMi4yLjg5LTEwLjIuMi45NSIKJGRlc2NyaXB0aW9uICMgRGVzY3JpcHRpb24gb2YgdGhlIHJ1bGUsIHRoaXMgd2lsbCBiZSBvcHRpb25hbC4jPgoKaWYgKCRlbnY6UFJPQ0VTU09SX0FSQ0hJVEVXNjQzMiAtZXEgIkFNRDY0IikgewogICAgaWYgKCRteUludm9jYXRpb24uTGluZSkgewogICAgICAgICYiJGVudjpzeXN0ZW1yb290XHN5c25hdGl2ZVx3aW5kb3dzcG93ZXJzaGVsbFx2MS4wXHBvd2Vyc2hlbGwuZXhlIiAtTm9uSW50ZXJhY3RpdmUgLU5vUHJvZmlsZSAkbXlJbnZvY2F0aW9uLkxpbmUKICAgIH0KICAgIGVsc2UgewogICAgICAgICYiJGVudjpzeXN0ZW1yb290XHN5c25hdGl2ZVx3aW5kb3dzcG93ZXJzaGVsbFx2MS4wXHBvd2Vyc2hlbGwuZXhlIiAtTm9uSW50ZXJhY3RpdmUgLU5vUHJvZmlsZSAtZmlsZSAiJCgkbXlJbnZvY2F0aW9uLkludm9jYXRpb25OYW1lKSIgJGFyZ3MKICAgIH0KICAgIGV4aXQgJGxhc3RleGl0Y29kZQp9CgppZigkcmVtb3Rlc2NvcGUpewogICAgJEVycm9yQWN0aW9uUHJlZmVyZW5jZSA9ICJTdG9wIgokcmVtb3RlYWRkcmVzcyA9ICRyZW1vdGVzY29wZSAtc3BsaXQgIiwiCmZvcmVhY2ggKCRpcCBpbiAkcmVtb3RlYWRkcmVzcykgewogICAgaWYgKCRpcCAtbWF0Y2ggIl4oKFswLTldfFsxLTldWzAtOV18MVswLTldezJ9fDJbMC00XVswLTldfDI1WzAtNV0pXC4pezN9KFswLTldfFsxLTldWzAtOV18MVswLTldezJ9fDJbMC00XVswLTldfDI1WzAtNV0pLSgoWzAtOV18WzEtOV1bMC05XXwxWzAtOV17Mn18MlswLTRdWzAtOV18MjVbMC01XSlcLil7M30oWzAtOV18WzEtOV1bMC05XXwxWzAtOV17Mn18MlswLTRdWzAtOV18MjVbMC01XSkkIikgeyAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICBbaXBhZGRyZXNzXSRmaXJzdCwgW2lwYWRkcmVzc10kc2Vjb25kID0gJGlwIC1zcGxpdCAiLSIKICAgICAgICAgICAgICAgICRJUEFkZHJlc3NlcyA9IEAoCgogICAgICAgICAgICAgICAgICAgIFtTeXN0ZW0uTmV0LklQQWRkcmVzc10kZmlyc3QKCiAgICAgICAgICAgICAgICAgICAgW1N5c3RlbS5OZXQuSVBBZGRyZXNzXSRzZWNvbmQKCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAkc29ydGVkID0gJElQQWRkcmVzc2VzIHwgU29ydCB8IFNlbGVjdCBJUEFkZHJlc3NUb1N0cmluZwogICAgICAgICAgICBpZigkc29ydGVkWzBdLklQQWRkcmVzc1RvU3RyaW5nIC1lcSAkZmlyc3QuSVBBZGRyZXNzVG9TdHJpbmcpewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBDb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgV3JpdGUtRXJyb3IgIkludmFsaWQgSVAgQWRkcmVzcyByYW5nZSAkaXAiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1FcnJvciAiSW52YWxpZCBJUCBBZGRyZXNzIHJhbmdlICRpcCIKICAgICAgICB9CiAgICB9CiAgICBlbHNlaWYgKCRpcCAtbWF0Y2ggIl4oKFswLTldfFsxLTldWzAtOV18MVswLTldezJ9fDJbMC00XVswLTldfDI1WzAtNV0pXC4pezN9KFswLTldfFsxLTldWzAtOV18MVswLTldezJ9fDJbMC00XVswLTldfDI1WzAtNV0pJCIpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBbaXBhZGRyZXNzXSR2YWxpZGF0ZWlwID0gJGlwCiAgICAgICAgICAgIENvbnRpbnVlOwogICAgICAgIH0gCiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1FcnJvciAiSW52YWxpZCBJUCBBZGRyZXNzICRpcCIKICAgICAgICB9CiAgICB9CiAgICBlbHNlewogICAgV3JpdGUtRXJyb3IgIkludmFsaWQgaXAgYWRkcmVzcyAkaXAiCiAgICB9Cn0KJEVycm9yQWN0aW9uUHJlZmVyZW5jZSA9ICJDb250aW51ZSIKfQoKaWYoJGxvY2Fsc2NvcGUpewogICAgJEVycm9yQWN0aW9uUHJlZmVyZW5jZSA9ICJTdG9wIgokbG9jYWxhZGRyZXNzID0gJGxvY2Fsc2NvcGUgLXNwbGl0ICIsIgpmb3JlYWNoICgkaXAgaW4gJGxvY2FsYWRkcmVzcykgewogICAgaWYgKCRpcCAtbWF0Y2ggIl4oKFswLTldfFsxLTldWzAtOV18MVswLTldezJ9fDJbMC00XVswLTldfDI1WzAtNV0pXC4pezN9KFswLTldfFsxLTldWzAtOV18MVswLTldezJ9fDJbMC00XVswLTldfDI1WzAtNV0pLSgoWzAtOV18WzEtOV1bMC05XXwxWzAtOV17Mn18MlswLTRdWzAtOV18MjVbMC01XSlcLil7M30oWzAtOV18WzEtOV1bMC05XXwxWzAtOV17Mn18MlswLTRdWzAtOV18MjVbMC01XSkkIikgeyAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICBbaXBhZGRyZXNzXSRmaXJzdCwgW2lwYWRkcmVzc10kc2Vjb25kID0gJGlwIC1zcGxpdCAiLSIKICAgICAgICAgICAgICAgICRJUEFkZHJlc3NlcyA9IEAoCgogICAgICAgICAgICAgICAgICAgIFtTeXN0ZW0uTmV0LklQQWRkcmVzc10kZmlyc3QKCiAgICAgICAgICAgICAgICAgICAgW1N5c3RlbS5OZXQuSVBBZGRyZXNzXSRzZWNvbmQKCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAkc29ydGVkID0gJElQQWRkcmVzc2VzIHwgU29ydCB8IFNlbGVjdCBJUEFkZHJlc3NUb1N0cmluZwogICAgICAgICAgICBpZigkc29ydGVkWzBdLklQQWRkcmVzc1RvU3RyaW5nIC1lcSAkZmlyc3QuSVBBZGRyZXNzVG9TdHJpbmcpewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBDb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgV3JpdGUtRXJyb3IgIkludmFsaWQgSVAgQWRkcmVzcyByYW5nZSAkaXAiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1FcnJvciAiSW52YWxpZCBJUCBBZGRyZXNzIHJhbmdlICRpcCIKICAgICAgICB9CiAgICB9CiAgICBlbHNlaWYgKCRpcCAtbWF0Y2ggIl4oKFswLTldfFsxLTldWzAtOV18MVswLTldezJ9fDJbMC00XVswLTldfDI1WzAtNV0pXC4pezN9KFswLTldfFsxLTldWzAtOV18MVswLTldezJ9fDJbMC00XVswLTldfDI1WzAtNV0pJCIpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBbaXBhZGRyZXNzXSR2YWxpZGF0ZWlwID0gJGlwCiAgICAgICAgICAgIENvbnRpbnVlOwogICAgICAgIH0gCiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1FcnJvciAiSW52YWxpZCBJUCBBZGRyZXNzICRpcCIKICAgICAgICB9CiAgICB9CiAgICBlbHNlewogICAgV3JpdGUtRXJyb3IgIkludmFsaWQgaXAgYWRkcmVzcyAkaXAiCiAgICB9Cn0KJEVycm9yQWN0aW9uUHJlZmVyZW5jZSA9ICJDb250aW51ZSIKfQoKCmZ1bmN0aW9uIFZhbGlkYXRlX3BvcnRzKCRwb3J0cykgewoKICAgICR2YWxpZGF0ZXBvcnQgPSAkcG9ydHMgLXNwbGl0ICIsIgogICAgZm9yZWFjaCAoJHBvcnQgaW4gJHZhbGlkYXRlcG9ydCkgewogICAgICAgIGlmICgkcG9ydCAtbGlrZSAiKi0qIikgewogICAgICAgICAgICBbaW50XSRyYW5nZTEsIFtpbnRdJHJhbmdlMiA9ICRwb3J0IC1zcGxpdCAiLSIKICAgICAgICAgICAgaWYgKCgkcmFuZ2UxIC1sZSA2NTUzNSkgLWFuZCAoJHJhbmdlMiAtbGUgNjU1MzUpIC1hbmQgKCIkcG9ydCIgLW1hdGNoICJeWzAtOV17MSw1fVwtWzAtOV17MSw1fSQiKSkgewogICAgICAgICAgICAgICAgQ29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBXcml0ZS1lcnJvciAiR2l2ZW4gcG9ydCBudW1iZXIgaXMgbm90IHZhbGlkIHBvcnQsIFBsZWFzZSBlbnRlciB2YWxpZCBwb3J0IG51bWJlci4iCiAgICAgICAgICAgICAgICBFeGl0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKChbaW50XSRwb3J0IC1sZSA2NTUzNSkpIHsKICAgICAgICAgICAgICAgIENvbnRpbnVlOyAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIFdyaXRlLWVycm9yICJHaXZlbiBwb3J0IG51bWJlciBpcyBub3QgdmFsaWQgcG9ydCwgUGxlYXNlIGVudGVyIHZhbGlkIHBvcnQgbnVtYmVyLiIKICAgICAgICAgICAgICAgIEV4aXQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQogICAgcmV0dXJuICR0cnVlCn0KCmZ1bmN0aW9uIHNldF9wcm9maWxlcyB7CiAgICAkbGVuZ3RoID0gJHByb2ZpbGVzLmxlbmd0aAogICAgaWYgKCRsZW5ndGggLWVxIDMpIHsKICAgICAgICByZXR1cm4gMjE0NzQ4MzY0NwogICAgfQogICAgZWxzZWlmICgkbGVuZ3RoIC1lcSAyKSB7CiAgICAgICAgaWYgKCgkcHJvZmlsZXMgLWNvbnRhaW5zICJEb21haW4iKSAtYW5kICgkcHJvZmlsZXMgLWNvbnRhaW5zICJQcml2YXRlIikpIHsgcmV0dXJuIDMgfQogICAgICAgIGlmICgoJHByb2ZpbGVzIC1jb250YWlucyAiRG9tYWluIikgLWFuZCAoJHByb2ZpbGVzIC1jb250YWlucyAiUHVibGljIikpIHsgcmV0dXJuIDUgfQogICAgICAgIGlmICgoJHByb2ZpbGVzIC1jb250YWlucyAiUHVibGljIikgLWFuZCAoJHByb2ZpbGVzIC1jb250YWlucyAiUHJpdmF0ZSIpKSB7IHJldHVybiA2IH0KICAgIH0KICAgIGVsc2UgewogICAgICAgIHN3aXRjaCAoJHByb2ZpbGVzKSB7CiAgICAgICAgICAgICJEb21haW4iIHsgcmV0dXJuIDEgfQogICAgICAgICAgICAiUHJpdmF0ZSIgeyByZXR1cm4gMiB9CiAgICAgICAgICAgICJQdWJsaWMiIHsgcmV0dXJuIDQgfQogICAgICAgIH0KICAgIH0KfQpmdW5jdGlvbiBBZGRfUHJvZ3JhbSB7CiAgICAkZmlyZXdhbGxydWxlID0gTmV3LU9iamVjdCAtQ29tT2JqZWN0IEhOZXRDZmcuRldSdWxlCiAgICAkZmlyZXdhbGxydWxlLk5hbWUgPSAkdGFza25hbWUKICAgICRmaXJld2FsbHJ1bGUuQXBwbGljYXRpb25OYW1lID0gJHByb2dyYW1wYXRoCiAgICBpZiAoKChUZXN0LXBhdGggJHByb2dyYW1wYXRoKSAtZXEgJGZhbHNlKSAtb3IgKCgoR2V0LUl0ZW0gIiRwcm9ncmFtcGF0aCIpIC1pcyBbU3lzdGVtLklPLkRpcmVjdG9yeUluZm9dKSAtZXEgJHRydWUpKSB7IFdyaXRlLUVycm9yICJQcm9ncmFtIHBhdGggcHJvdmlkZWQgaXMgaW5jb3JyZWN0LCBwbGVhc2UgcHJvdmlkZSB2YWxpZCBmaWxlIHBhdGguIjsgRXhpdDsgfQogICAgc3dpdGNoICgkZGlyZWN0aW9uKSB7CiAgICAgICAgI3N3aXRjaCBzdGF0ZW1lbnQgZm9yIEluYm91bmQgYW5kIG91dGJvdW5kIGRpcmVjdGlvbgogICAgICAgICJJbmJvdW5kIiB7ICRmaXJld2FsbHJ1bGUuRGlyZWN0aW9uID0gMTsgYnJlYWsgfQogICAgICAgICJPdXRib3VuZCIgeyAkZmlyZXdhbGxydWxlLkRpcmVjdGlvbiA9IDI7IGJyZWFrIH0KICAgIH0KICAgIHN3aXRjaCAoJGFjdGlvbikgewogICAgICAgICJBbGxvdyIgeyAkZmlyZXdhbGxydWxlLkFjdGlvbiA9IDE7IGJyZWFrIH0KICAgICAgICAiQmxvY2siIHsgJGZpcmV3YWxscnVsZS5BY3Rpb24gPSAwOyBicmVhayB9CiAgICB9CiAgICAKICAgICRzZXRwcm9maWxlID0gc2V0X3Byb2ZpbGVzCiAgICAkZmlyZXdhbGxydWxlLlByb2ZpbGVzID0gJHNldHByb2ZpbGUKICAgIGlmKCRyZW1vdGVzY29wZSl7CiAgICAkZmlyZXdhbGxydWxlLlJlbW90ZUFkZHJlc3NlcyA9ICRyZW1vdGVzY29wZQogICAgfQogICAgaWYoJGxvY2Fsc2NvcGUpewogICAgJGZpcmV3YWxscnVsZS5Mb2NhbEFkZHJlc3NlcyA9ICRsb2NhbHNjb3BlCiAgICB9CiAgICAkZmlyZXdhbGxydWxlLkVuYWJsZWQgPSAxCiAgICByZXR1cm4gJGZpcmV3YWxscnVsZQp9CgpmdW5jdGlvbiBBZGRfcG9ydCB7CiAgICAkZmlyZXdhbGxydWxlID0gTmV3LU9iamVjdCAtQ29tT2JqZWN0IEhOZXRDZmcuRldSdWxlCiAgICAkZmlyZXdhbGxydWxlLk5hbWUgPSAkdGFza25hbWUKICAgIHN3aXRjaCAoJHByb3RvY29sKSB7CiAgICAgICAgIlRDUCIgeyAkZmlyZXdhbGxydWxlLlByb3RvY29sID0gNjsgYnJlYWsgfQogICAgICAgICJVRFAiIHsgJGZpcmV3YWxscnVsZS5Qcm90b2NvbCA9IDE3OyBicmVhayB9CiAgICB9CiAgICBzd2l0Y2ggKCRkaXJlY3Rpb24pIHsKICAgICAgICAiSW5ib3VuZCIgewogICAgICAgICAgICAkZmlyZXdhbGxydWxlLkRpcmVjdGlvbiA9IDE7CiAgICAgICAgICAgIGlmICgkcG9ydG51bWJlcnMgLW5lICIiKSB7CiAgICAgICAgICAgICAgICAkdmVyaWZ5cG9ydHMgPSBWYWxpZGF0ZV9wb3J0cyAtcG9ydHMgJHBvcnRudW1iZXJzCiAgICAgICAgICAgICAgICBpZigkdmVyaWZ5cG9ydHMpewogICAgICAgICAgICAgICAgJGZpcmV3YWxscnVsZS5Mb2NhbFBvcnRzID0gJHBvcnRudW1iZXJzCiAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgICJPdXRib3VuZCIgewogICAgICAgICAgICAkZmlyZXdhbGxydWxlLkRpcmVjdGlvbiA9IDI7CiAgICAgICAgICAgIGlmICgkcG9ydG51bWJlcnMgLW5lICIiKXsKICAgICAgICAgICAgICAgICR2ZXJpZnlwb3J0cyA9IFZhbGlkYXRlX3BvcnRzIC1wb3J0cyAkcG9ydG51bWJlcnMKICAgICAgICAgICAgICAgIGlmKCR2ZXJpZnlwb3J0cyl7CiAgICAgICAgICAgICAgICAkZmlyZXdhbGxydWxlLlJlbW90ZVBvcnRzID0gJHBvcnRudW1iZXJzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgfQogICAgCiAgICAkc2V0cHJvZmlsZSA9IHNldF9wcm9maWxlcwogICAgJGZpcmV3YWxscnVsZS5Qcm9maWxlcyA9ICRzZXRwcm9maWxlCiAgICAKICAgIHN3aXRjaCAoJGFjdGlvbikgewogICAgICAgICJBbGxvdyIgeyAkZmlyZXdhbGxydWxlLkFjdGlvbiA9IDE7IGJyZWFrIH0KICAgICAgICAiQmxvY2siIHsgJGZpcmV3YWxscnVsZS5BY3Rpb24gPSAwOyBicmVhayB9CiAgICB9CiAgICBpZigkcmVtb3Rlc2NvcGUpewogICAgJGZpcmV3YWxscnVsZS5SZW1vdGVBZGRyZXNzZXMgPSAkcmVtb3Rlc2NvcGUKICAgIH0KICAgIGlmKCRsb2NhbHNjb3BlKXsKICAgICRmaXJld2FsbHJ1bGUuTG9jYWxBZGRyZXNzZXMgPSAkbG9jYWxzY29wZQogICAgfQogICAgJGZpcmV3YWxscnVsZS5FbmFibGVkID0gMQogICAgcmV0dXJuICRmaXJld2FsbHJ1bGUgICAgICAgCn0KCmZ1bmN0aW9uIGRlbGV0ZV9maXJld2FsbHJ1bGUoJGRlbGV0ZXJ1bGVmb3IpIHsKICAgIHN3aXRjaCAoJGRpcmVjdGlvbikgewogICAgICAgICJJbmJvdW5kIiB7ICR2YWx1ZSA9IDEgfQogICAgICAgICJPdXRib3VuZCIgeyAkdmFsdWUgPSAyIH0KICAgIH0KICAgIHN3aXRjaCAoJGRlbGV0ZXJ1bGVmb3IpIHsKICAgICAgICAiUHJvZ3JhbSIgewogICAgICAgICAgICAkZndQb2xpY3kgPSBOZXctT2JqZWN0IC1Db21PYmplY3QgSE5ldENmZy5Gd1BvbGljeTIKICAgICAgICAgICAgJHJ1bGUgPSAkZndwb2xpY3kuUnVsZXMgfCA/IHsgKCRfLkFwcGxpY2F0aW9uTmFtZSAtZXEgJHByb2dyYW1wYXRoKSAtYW5kICgkXy5EaXJlY3Rpb24gLWVxICR2YWx1ZSkgfSB8IFNlbGVjdCAtRXhwYW5kUHJvcGVydHkgTmFtZQogICAgICAgICAgICBuZXRzaCBhZHZmaXJld2FsbCBmaXJld2FsbCBkZWxldGUgcnVsZSBuYW1lPSRydWxlIHwgT3V0LU51bGwKICAgICAgICAgICAgaWYgKCRMQVNURVhJVENPREUgLWVxIDApIHsKICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgIlBvcnQiIHsKICAgICAgICAgICAgJGZ3UG9saWN5ID0gTmV3LU9iamVjdCAtQ29tT2JqZWN0IEhOZXRDZmcuRndQb2xpY3kyCiAgICAgICAgICAgIHN3aXRjaCAoJHByb3RvY29sKSB7CiAgICAgICAgICAgICAgICAiVENQIiB7ICRwb3J0dmFsdWUgPSA2IH0KICAgICAgICAgICAgICAgICJVRFAiIHsgJHBvcnR2YWx1ZSA9IDE3IH0KICAgICAgICAgICAgfQogICAgICAgICAgICBzd2l0Y2ggKCR2YWx1ZSkgewogICAgICAgICAgICAgICAgMSB7CiAgICAgICAgICAgICAgICAgICAgaWYoKCRwb3J0bnVtYmVycy5nZXR0eXBlKCkpLk5hbWUgLW5lICJTdHJpbmciKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHZlcmlmeXBvcnQgPSAkcG9ydG51bWJlcnMgLWpvaW4gIiwiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICR2ZXJpZnlwb3J0ID0gJHBvcnRudW1iZXJzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRydWxlID0gJGZ3cG9saWN5LlJ1bGVzIHwgPyB7ICgkXy5OYW1lIC1lcSAkdGFza25hbWUpIC1hbmQgKCRfLkRpcmVjdGlvbiAtZXEgJHZhbHVlKSAtYW5kICAoJF8uUHJvdG9jb2wgLWVxICRwb3J0dmFsdWUpIC1hbmQgKCRfLkxvY2FsUG9ydHMgLWVxICR2ZXJpZnlwb3J0KSB9IHwgU2VsZWN0IC1FeHBhbmRQcm9wZXJ0eSBOYW1lCgogICAgICAgICAgICAgICAgICAgIGlmICghJHJ1bGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJ1bGUgPSAkZndwb2xpY3kuUnVsZXMgfCA/IHsgKCRfLk5hbWUgLWVxICR0YXNrbmFtZSkgLWFuZCAoJF8uRGlyZWN0aW9uIC1lcSAkdmFsdWUpIC1hbmQgKCRfLlByb3RvY29sIC1lcSAkcG9ydHZhbHVlKSB9OyBpZiAoISRydWxlKSB7IFdyaXRlLW91dHB1dCAiUnVsZSBub3QgZm91bmQiOyBFeGl0IH0KICAgICAgICAgICAgICAgICAgICAgICAgJHVwZGF0ZXBvcnQgPSBAKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRydWxlLkxvY2FsUG9ydHMgLW1hdGNoICIsIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRlbXAgPSAkcnVsZS5Mb2NhbFBvcnRzIC1zcGxpdCAiLCIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRlbXAgLWNvbnRhaW5zICR2ZXJpZnlwb3J0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkbG9jYWxwb3J0IGluICR0ZW1wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRsb2NhbHBvcnQgLW5lICR2ZXJpZnlwb3J0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR1cGRhdGVwb3J0ICs9ICRsb2NhbHBvcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdXBkYXRlcG9ydCA9ICR1cGRhdGVwb3J0IC1qb2luICIsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJ1bGUubG9jYWxwb3J0cyA9ICR1cGRhdGVwb3J0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgMiB7IAogICAgICAgICAgICAgICAgICAgIGlmKCgkcG9ydG51bWJlcnMuZ2V0dHlwZSgpKS5OYW1lIC1uZSAiU3RyaW5nIil7CiAgICAgICAgICAgICAgICAgICAgICAgICR2ZXJpZnlwb3J0ID0gJHBvcnRudW1iZXJzIC1qb2luICIsIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICAkdmVyaWZ5cG9ydCA9ICRwb3J0bnVtYmVycwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkcnVsZSA9ICRmd3BvbGljeS5SdWxlcyB8ID8geyAoJF8uTmFtZSAtZXEgJHRhc2tuYW1lKSAtYW5kICgkXy5EaXJlY3Rpb24gLWVxICR2YWx1ZSkgLWFuZCAgKCRfLlByb3RvY29sIC1lcSAkcG9ydHZhbHVlKSAtYW5kICgkXy5SZW1vdGVQb3J0cyAtZXEgJHZlcmlmeXBvcnQpIH0gfCBTZWxlY3QgLUV4cGFuZFByb3BlcnR5IE5hbWUKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoISRydWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRydWxlID0gJGZ3cG9saWN5LlJ1bGVzIHwgPyB7ICgkXy5OYW1lIC1lcSAkdGFza25hbWUpIC1hbmQgKCRfLkRpcmVjdGlvbiAtZXEgJHZhbHVlKSAtYW5kICgkXy5Qcm90b2NvbCAtZXEgJHBvcnR2YWx1ZSkgfTsgaWYgKCEkcnVsZSkgeyBXcml0ZS1vdXRwdXQgIlJ1bGUgbm90IGZvdW5kIjsgRXhpdCB9CiAgICAgICAgICAgICAgICAgICAgICAgICR1cGRhdGVwb3J0ID0gQCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcnVsZS5SZW1vdGVQb3J0cyAtbWF0Y2ggIiwiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGVtcCA9ICRydWxlLlJlbW90ZVBvcnRzIC1zcGxpdCAiLCIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRlbXAgLWNvbnRhaW5zICR2ZXJpZnlwb3J0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmVtb3RlcG9ydCBpbiAkdGVtcCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcmVtb3RlcG9ydCAtbmUgJHZlcmlmeXBvcnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVwZGF0ZXBvcnQgKz0gJHJlbW90ZXBvcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdXBkYXRlcG9ydCA9ICR1cGRhdGVwb3J0IC1qb2luICIsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJ1bGUucmVtb3RlcG9ydHMgPSAkdXBkYXRlcG9ydAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAgICAgICAgCiAgICAgICAgICAgIG5ldHNoIGFkdmZpcmV3YWxsIGZpcmV3YWxsIGRlbGV0ZSBydWxlIG5hbWU9JHJ1bGUgfCBPdXQtbnVsbAogICAgICAgICAgICBpZigkTEFTVEVYSVRDT0RFIC1lcSAwKXtyZXR1cm4gMH0KICAgICAgICAgICAgZWxzZXtyZXR1cm4gLTF9CiAgICAgICAgfQogICAgfQp9CgogICAgaWYgKCgkcnVsZXR5cGUgLWVxICJQcm9ncmFtIikgLWFuZCAoJHRhc2sgLWVxICJDcmVhdGUiKSkgewogICAgICAgICRmd1BvbGljeSA9IE5ldy1PYmplY3QgLUNvbU9iamVjdCBITmV0Q2ZnLkZ3UG9saWN5MgogICAgICAgICRmd1BvbGljeS5SdWxlcy5BZGQoKEFkZF9Qcm9ncmFtKSkKICAgICAgICBpZiAoJD8pIHsKICAgICAgICAgICAgV3JpdGUtb3V0cHV0ICJSdWxlIGhhcyBiZWVuIGFkZGVkIHN1Y2Nlc3NmdWxseSBmb3IgcHJvZ3JhbS4iCiAgICAgICAgICAgIEV4aXQ7CiAgICAgICAgfQogICAgfQogICAgZWxzZWlmICgoJHJ1bGV0eXBlIC1lcSAiUG9ydCIpIC1hbmQgKCR0YXNrIC1lcSAiQ3JlYXRlIikpIHsKICAgICAgICAkZndQb2xpY3kgPSBOZXctT2JqZWN0IC1Db21PYmplY3QgSE5ldENmZy5Gd1BvbGljeTIKICAgICAgICAkZndQb2xpY3kuUnVsZXMuQWRkKChBZGRfcG9ydCkpCiAgICAgICAgaWYgKCQ/KSB7CiAgICAgICAgICAgIFdyaXRlLW91dHB1dCAiUnVsZSBoYXMgYmVlbiBhZGRlZCBzdWNjZXNzZnVsbHkgZm9yIHBvcnQuIgogICAgICAgICAgICBFeGl0OwogICAgICAgIH0KICAgIH0KCgokRXJyb3JBY3Rpb25QcmVmZXJlbmNlID0gIkNvbnRpbnVlIgppZiAoJHRhc2sgLWVxICJEZWxldGUiKSB7CiAgICBpZiAoISRwb3J0bnVtYmVycykgewogICAgICAgIHN3aXRjaCAoJGRpcmVjdGlvbikgewogICAgICAgICAgICAiSW5ib3VuZCIgeyAkdmFsdWUgPSAxIH0KICAgICAgICAgICAgIk91dGJvdW5kIiB7ICR2YWx1ZSA9IDIgfQogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKCRwcm90b2NvbCkgewogICAgICAgICAgICAiVENQIiB7ICRwb3J0dmFsdWUgPSA2IH0KICAgICAgICAgICAgIlVEUCIgeyAkcG9ydHZhbHVlID0gMTcgfQogICAgICAgIH0KICAgICAgICAkZndQb2xpY3kgPSBOZXctT2JqZWN0IC1Db21PYmplY3QgSE5ldENmZy5Gd1BvbGljeTIgICAgCiAgICAgICAgJHJ1bGUxID0gJGZ3cG9saWN5LlJ1bGVzIHwgPyB7ICgkXy5OYW1lIC1lcSAkdGFza25hbWUpIC1hbmQgKCRfLkRpcmVjdGlvbiAtZXEgJHZhbHVlKSAtYW5kICgkXy5Qcm90b2NvbCAtZXEgJHBvcnR2YWx1ZSkgfQogCiAgICAgICAgaWYgKCRydWxlMSkgewogICAgICAgICAgICAkcnVsZW5hbWUgPSAkcnVsZTEuTmFtZQogICAgICAgICAgICBuZXRzaCBhZHZmaXJld2FsbCBmaXJld2FsbCBkZWxldGUgcnVsZSBuYW1lPSRydWxlbmFtZSB8IE91dC1udWxsCiAgICAgICAgICAgIGlmKCRMQVNURVhJVENPREUgLWVxIDApe1dyaXRlLW91dHB1dCAiUnVsZSBoYXMgYmVlbiBkZWxldGVkIHN1Y2Nlc3NmdWxseSJ9CiAgICAgICAgICAgIEVsc2V7V3JpdGUtRXJyb3IgIkZhaWxlZCB0byBkZWxldGUgcnVsZS4ifQogICAgICAgICAgICBFeGl0OwogICAgICAgIH0KICAgIH0KICAgICRkZWxldGVyZXN1bHQgPSBkZWxldGVfZmlyZXdhbGxydWxlIC1kZWxldGVydWxlZm9yICRydWxldHlwZQogICAgc3dpdGNoICgkZGVsZXRlcmVzdWx0KSB7CiAgICAgICAgMCB7IFdyaXRlLW91dHB1dCAiUnVsZSBoYXMgYmVlbiBkZWxldGVkIHN1Y2Nlc3NmdWxseSIgfQogICAgICAgIDEgeyBXcml0ZS1vdXRwdXQgIkxvY2FsIFBvcnQgaGFzIGJlZW4gcmVtb3ZlZCIgfQogICAgICAgIDIgeyBXcml0ZS1vdXRwdXQgIlJlbW90ZSBQb3J0IGhhcyBiZWVuIHJlbW92ZWQiIH0KICAgICAgICBEZWZhdWx0IHsgV3JpdGUtb3V0cHV0ICJSdWxlIG5vdCBmb3VuZCIgfQogICAgfQp9CgoKCg==","jsonSchema":{"additionalproperties":false,"dependencies":{"task":{"oneOf":[{"dependencies":{"ruleType":{"oneOf":[{"properties":{"portnumbers":{"title":"Portnumber(s)","type":"string"},"protocol":{"default":"TCP","enum":["TCP","UDP"],"title":"Protocol","type":"string"},"ruleType":{"enum":["Port"]}},"required":["protocol"]},{"properties":{"programpath":{"title":"Program path","type":"string"},"ruleType":{"enum":["Program"]}},"required":["programpath"]}]}},"properties":{"Action":{"enum":["Allow","Block"],"title":"Action","type":"string"},"description":{"title":"Description","type":"string"},"direction":{"default":"Inbound","enum":["Inbound","Outbound"],"title":"Direction","type":"string"},"localscope":{"title":"Local Scope","type":"string"},"profiles":{"items":{"enum":["Domain","Private","Public"],"type":"string"},"title":"Profiles","type":"array","uniqueItems":true},"remotescope":{"title":"Remote Scope","type":"string"},"ruleType":{"enum":["Port","Program"],"title":"Rule Type","type":"string"},"task":{"enum":["Create"]},"taskname":{"title":"Rule Name","type":"string"}},"required":["Action","taskname","ruleType","profiles"]},{"dependencies":{"ruleType":{"oneOf":[{"properties":{"portnumbers":{"title":"Protnumber(s)","type":"string"},"protocol":{"default":"TCP","enum":["TCP","UDP"],"title":"Protocol","type":"string"},"ruleType":{"enum":["Port"]},"taskname":{"title":"Rule Name","type":"string"}},"required":["taskname","protocol"]},{"properties":{"programpath":{"title":"Program path","type":"string"},"ruleType":{"enum":["Program"]}},"required":["programpath"]}]}},"properties":{"direction":{"default":"Inbound","enum":["Inbound","Outbound"],"title":"Direction","type":"string"},"ruleType":{"default":"Port","enum":["Port","Program"],"title":"Rule Type","type":"string"},"task":{"enum":["Delete"]}},"required":["direction"]}]}},"patternproperties":{"^Action$":{},"^description$":{},"^direction$":{},"^localscope$":{},"^portnumbers$":{},"^profiles$":{},"^programpath$":{},"^protocol$":{},"^remotescope$":{},"^ruleType$":{},"^taskname$":{}},"properties":{"task":{"default":"Create","enum":["Create","Delete"],"title":"Action","type":"string"}},"type":"object"},"uiSchema":{"Action":{"classNames":"col-sm-3","ui:autofocus":true,"ui:placeholder":"Select"},"description":{"classNames":"col-sm-8","ui:autofocus":true},"direction":{"classNames":"col-sm-3","ui:autofocus":true},"localscope":{"classNames":"col-sm-6","ui:autofocus":true,"ui:help":"Ex: 192.168.10.1, 10.11.13.9, 192.168.10.2-192.168.10.100. or leave it blank to allow Any hosts."},"portnumbers":{"classNames":"col-sm-3","ui:autofocus":true,"ui:help":"Ex: 80,5000-5010"},"profiles":{"classNames":"col-sm-12","ui:autofocus":true,"ui:options":{"inline":true},"ui:widget":"checkboxes"},"programpath":{"classNames":"col-sm-6","ui:autofocus":true,"ui:help":"Ex: C:\\folder\\program.exe"},"protocol":{"classNames":"col-sm-3","ui:autofocus":true},"remotescope":{"classNames":"col-sm-6","ui:autofocus":true,"ui:help":"Ex: 192.168.10.1, 10.11.13.9, 192.168.10.2-192.168.10.100. or leave it blank to allow Any hosts."},"ruleType":{"classNames":"col-sm-3","ui:autofocus":true,"ui:placeholder":"Select"},"task":{"classNames":"col-sm-3 col-sm-offset-right-9","ui:autofocus":true},"taskname":{"classNames":"col-sm-4","ui:autofocus":true},"ui:order":["task","taskname","description","ruleType","direction","protocol","portnumbers","programpath","Action","profiles","localscope","remotescope"]},"isHDScript":false}