{"id":"1e743397-65d3-11e9-a656-00155d130b01","partnerId":"00000000-0000-0000-0000-000000000000","category":["Maintenance"],"description":"Download a specified file/folder (resource) from an FTP server to the local file system","engine":"powershell","engineMaxVersion":5,"expectedExecutionTimeSec":3600,"failureMessage":"Executed with errors","successMessage":"Excecuted successfully","internal":false,"name":"FTP download","tags":["Windows 7","Windows 10"],"sequence":true,"content":"IyByZWdpb24gSW5wdXRWYXJpYWJsZXMKIyAkQ29ubmVjdGlvblBhdGggPSAnZnRwOi8vMTAuMi4xMzAuMjcnICAgIyBTdHJpbmcgCiMgJFVzZXJuYW1lID0gIkZUUFVzZXIiICAgIyBTdHJpbmcgIAojICRQYXNzd29yZCA9ICJ0ZXN0QDEyMyIgICAjIFN0cmluZyAKIyAkVHlwZSA9ICdGaWxlJyAgIyBTdHJpbmcKIyAkU291cmNlID0gJ0Nocm9tZVNldHVwLmV4ZScgICAjIFN0cmluZyAKIyAkUmVjdXJzZSA9ICR0cnVlICAgIyBCb29sZWFuCiMgJERlc3RpbmF0aW9uID0gJ0M6XHBhcnRuZXJcJyAgICMgU3RyaW5nCiMgJENyZWF0ZURlc3RpbmF0aW9uRm9sZGVyID0gJFRydWUgIyBCb29sZWFuCiMgJFBlcmZvcm1QcmVDaGVjayA9ICRmYWxzZSAgICMgQm9vbGVhbgojICRQcmVDaGVja1R5cGUgPSAnQ2hlY2sgaWYgZmlsZSBleGlzdHMnICAgIyBTdHJpbmcKIyAkUHJlQ2hlY2tBY3Rpb24gPSAnSWYgZmlsZSBkb2VzIG5vdCBleGlzdHMgdGhlbiBDb250aW51ZScgICAjIFN0cmluZwojICRQcmVDaGVja0ZpbGVOYW1lID0gJ0M6XHhcY3NldHVwLmV4ZScgICAjIFN0cmluZwojICRQcmVDaGVja1ZlcnNpb24gPSAnNy4wLjQuMycgICAjIFN0cmluZwojICRQcmVDaGVja01ENUNoZWNrc3VtID0gJ0Q0MUQ4Q0Q5OEYwMEIyMDRFOTgwMDk5OEVDRjg0MjdFdScgICAjIFN0cmluZwojICRQcmVDaGVja0tleSA9ICdIS0VZX0xPQ0FMX01BQ0hJTkVcU09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cVW5pbnN0YWxsXERCIEJyb3dzZXIgZm9yIFNRTGl0ZScgICAjIFN0cmluZwojICRQcmVDaGVja1ZhbHVlID0gJ25vbW9kaWZ5JyAgICMgU3RyaW5nCiMgJFByZUNoZWNrRGF0YSA9ICcxJyAgICMgU3RyaW5nCiMgJFBlcmZvcm1Qb3N0Q2hlY2sgPSAkZmFsc2UgICAjIEJvb2xlYW4KIyAkUG9zdENoZWNrRmlsZU5hbWUgPSAnQzpceFxjc2V0dXBkLmV4ZScgICAjIFN0cmluZwojICRQb3N0Q2hlY2tNRDVDaGVja3N1bSA9ICc5MDc0MjcwOTlERTJFNTA0QkIyN0JGNENFRDVFREM1RScgICAjIFN0cmluZwojICRQb3N0Q2hlY2tBY3Rpb24gPSAnSWYgZmlsZSBleGlzdHMgYW5kIE1ENSBjaGVja3N1bSBtYXRjaGVzIHRoZW4gU3VjY2VzcycgICAjIFN0cmluZwojZW5kcmVnaW9uIElucHV0VmFyaWFibGVzCgppZiAoJGVudjpQUk9DRVNTT1JfQVJDSElURVc2NDMyIC1lcSAiQU1ENjQiKSB7CiAgICBpZiAoJG15SW52b2NhdGlvbi5MaW5lKSB7CiAgICAgICAgJiIkZW52OnN5c3RlbXJvb3Rcc3lzbmF0aXZlXHdpbmRvd3Nwb3dlcnNoZWxsXHYxLjBccG93ZXJzaGVsbC5leGUiIC1Ob25JbnRlcmFjdGl2ZSAtTm9Qcm9maWxlICRteUludm9jYXRpb24uTGluZQogICAgfQogICAgZWxzZSB7CiAgICAgICAgJiIkZW52OnN5c3RlbXJvb3Rcc3lzbmF0aXZlXHdpbmRvd3Nwb3dlcnNoZWxsXHYxLjBccG93ZXJzaGVsbC5leGUiIC1Ob25JbnRlcmFjdGl2ZSAtTm9Qcm9maWxlIC1maWxlICIkKCRteUludm9jYXRpb24uSW52b2NhdGlvbk5hbWUpIiAkYXJncwogICAgfQogICAgZXhpdCAkbGFzdGV4aXRjb2RlCn0gIAoKI3JlZ2lvbiBGdW5jdGlvbnMKRnVuY3Rpb24gTGlzdEZUUEl0ZW1zIHsgCiAgICBQYXJhbSgKICAgICAgICBbU3RyaW5nXSRQYXRoID0gIiIsCiAgICAgICAgJENyZWRlbnRpYWxzLAogICAgICAgIFtTd2l0Y2hdJFJlY3Vyc2UsICAgIAogICAgICAgIFtJbnRdJERlcHRoID0gMCwgICAgICAgIAogICAgICAgIFtTdHJpbmddJEZpbHRlciA9ICIqIgogICAgKQogICAgCiAgICBQcm9jZXNzIHsKICAgICAgICBpZiAoISgkUGF0aCAtbWF0Y2ggImZ0cDovLyIpKSB7ICRQYXRoID0gImZ0cDovLyIgKyAkUGF0aCB9CiAgICAgICAgJFBhdGggPSBbcmVnZXhdOjpSZXBsYWNlKCRQYXRoLCAnLyQnLCAnJykKICAgICAgICAkUGF0aCA9IFtyZWdleF06OlJlcGxhY2UoJFBhdGgsICcvKycsICcvJykKICAgICAgICAkUGF0aCA9IFtyZWdleF06OlJlcGxhY2UoJFBhdGgsICdeZnRwOi8nLCAnZnRwOi8vJykKCiAgICAgICAgaWYgKCREZXB0aCAtZ3QgMCkgewogICAgICAgICAgICAkQ3VycmVudERlcHRoID0gW3JlZ2V4XTo6bWF0Y2hlcygkUGF0aCwgIi8iKS5jb3VudAogICAgICAgICAgICBpZiAoKEdldC1WYXJpYWJsZSAtU2NvcGUgU2NyaXB0IC1OYW1lIE1heERlcHRoIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSAtZXEgJG51bGwpIHsKICAgICAgICAgICAgICAgIE5ldy1WYXJpYWJsZSAtU2NvcGUgU2NyaXB0IC1OYW1lIE1heERlcHRoIC1WYWx1ZSAoW0ludF0kQ3VycmVudERlcHRoICsgJERlcHRoKQogICAgICAgICAgICB9CiAgICAgICAgICAgICRSZWN1cnNlID0gJHRydWUKICAgICAgICB9CiAgCiAgICAgICAgaWYgKChHZXRGVFBJdGVtU2l6ZSAkUGF0aCAtQ3JlZGVudGlhbHMgJENyZWRlbnRpYWxzIC1TaWxlbnQpIC1lcSAtMSkgewogICAgICAgICAgICAkUGFyZW50UGF0aCA9ICRQYXRoCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkTGFzdEluZGV4ID0gJFBhdGguTGFzdEluZGV4T2YoIi8iKQogICAgICAgICAgICAkUGFyZW50UGF0aCA9ICRQYXRoLlN1YlN0cmluZygwLCAkTGFzdEluZGV4KQogICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgW1N5c3RlbS5OZXQuRnRwV2ViUmVxdWVzdF0kUmVxdWVzdCA9IFtTeXN0ZW0uTmV0LldlYlJlcXVlc3RdOjpDcmVhdGUoJFBhdGgpCiAgICAgICAgJFJlcXVlc3QuQ3JlZGVudGlhbHMgPSAkQ3JlZGVudGlhbHMKICAgICAgICAgICAgCiAgICAgICAgJFJlcXVlc3QuTWV0aG9kID0gW1N5c3RlbS5OZXQuV2ViUmVxdWVzdE1ldGhvZHMrRlRQXTo6TGlzdERpcmVjdG9yeURldGFpbHMKICAgICAgICBUcnkgewogICAgICAgICAgICAkTW9kZSA9ICJVbmtub3duIgogICAgICAgICAgICAkUmVzcG9uc2UgPSAkUmVxdWVzdC5HZXRSZXNwb25zZSgpCiAgICAgICAgICAgIFtTeXN0ZW0uSU8uU3RyZWFtUmVhZGVyXSRTdHJlYW0gPSBOZXctT2JqZWN0IFN5c3RlbS5JTy5TdHJlYW1SZWFkZXIoJFJlc3BvbnNlLkdldFJlc3BvbnNlU3RyZWFtKCksIFtTeXN0ZW0uVGV4dC5FbmNvZGluZ106OkRlZmF1bHQpCiAgICAgICAgICAgICREaXJlY3RvcnlMaXN0ID0gQCgpCiAgICAgICAgICAgICRJdGVtc0NvbGxlY3Rpb24gPSBAKCkKICAgICAgICAgICAgVHJ5IHsKICAgICAgICAgICAgICAgIFtzdHJpbmddJExpbmUgPSAkU3RyZWFtLlJlYWRMaW5lKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBDYXRjaCB7CiAgICAgICAgICAgICAgICAkTGluZSA9ICRudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICBXaGlsZSAoJExpbmUpIHsKICAgICAgICAgICAgICAgIGlmICgkTW9kZSAtZXEgIkNvbXBhdGlibGUiIC1vciAkTW9kZSAtZXEgIlVua25vd24iKSB7CiAgICAgICAgICAgICAgICAgICAgJG51bGwsIFtzdHJpbmddJElzRGlyZWN0b3J5LCBbc3RyaW5nXSRGbGFnLCBbc3RyaW5nXSRMaW5rLCBbc3RyaW5nXSRVc2VyTmFtZSwgW3N0cmluZ10kR3JvdXBOYW1lLCBbc3RyaW5nXSRTaXplLCBbc3RyaW5nXSREYXRlLCBbc3RyaW5nXSROYW1lID0gW3JlZ2V4XTo6c3BsaXQoJExpbmUsICdeKFtkLV0pKFtyd3h0LV17OX0pXHMrKFxkezEsfSlccysoWy5AQS1aYS16MC05LV0rKVxzKyhbQS1aYS16MC05LV0rKVxzKyhcZHsxLH0pXHMrKFx3K1xzK1xkezEsMn1ccytcZHsxLDJ9Oj9cZHsyfSlccysoLis/KVxzPyQnLCAiU2luZ2xlTGluZSxJZ25vcmVDYXNlLElnbm9yZVBhdHRlcm5XaGl0ZXNwYWNlIikKCiAgICAgICAgICAgICAgICAgICAgaWYgKCRJc0RpcmVjdG9yeSAtZXEgIiIgLWFuZCAkTW9kZSAtZXEgIlVua25vd24iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRNb2RlID0gIklJUzYiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoJE1vZGUgLW5lICJDb21wYXRpYmxlIikgewogICAgICAgICAgICAgICAgICAgICAgICAkTW9kZSA9ICJDb21wYXRpYmxlIiAjSUlTNy9MaW51eAogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgI1dyaXRlLUhvc3QgJE1vZGUgLUZvcmVncm91bmRDb2xvciBSZWQKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKCRNb2RlIC1lcSAiQ29tcGF0aWJsZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJERhdGVQYXJ0ID0gJERhdGUgLXNwbGl0ICJccysiCiAgICAgICAgICAgICAgICAgICAgICAgICROZXdEYXRlU3RyaW5nID0gIiQoJERhdGVQYXJ0WzBdKSAkKCd7MDpEMn0nIC1mIFtpbnRdJERhdGVQYXJ0WzFdKSAkKCREYXRlUGFydFsyXSkiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgVHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkRGF0ZVBhcnRbMl0gLW1hdGNoICI6IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNb250aCA9IChbRGF0ZVRpbWVdOjpQYXJzZUV4YWN0KCREYXRlUGFydFswXSwgIk1NTSIsIFtTeXN0ZW0uR2xvYmFsaXphdGlvbi5DdWx0dXJlSW5mb106OkludmFyaWFudEN1bHR1cmUpKS5Nb250aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoR2V0LURhdGUpLk1vbnRoIC1nZSAkTW9udGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5ld0RhdGUgPSBbRGF0ZVRpbWVdOjpQYXJzZUV4YWN0KCROZXdEYXRlU3RyaW5nLCAiTU1NIGRkIEhIOm1tIiwgW1N5c3RlbS5HbG9iYWxpemF0aW9uLkN1bHR1cmVJbmZvXTo6SW52YXJpYW50Q3VsdHVyZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICROZXdEYXRlID0gKFtEYXRlVGltZV06OlBhcnNlRXhhY3QoJE5ld0RhdGVTdHJpbmcsICJNTU0gZGQgSEg6bW0iLCBbU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm9dOjpJbnZhcmlhbnRDdWx0dXJlKSkuQWRkWWVhcnMoLTEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5ld0RhdGUgPSBbRGF0ZVRpbWVdOjpQYXJzZUV4YWN0KCROZXdEYXRlU3RyaW5nLCAiTU1NIGRkIHl5eXkiLCBbU3lzdGVtLkdsb2JhbGl6YXRpb24uQ3VsdHVyZUluZm9dOjpJbnZhcmlhbnRDdWx0dXJlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIENhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjaWYgKCRNb2RlIC1lcSAiSUlTNiIpIHsKICAgICAgICAgICAgICAgICMgICAgJG51bGwsIFtzdHJpbmddJE5ld0RhdGUsIFtzdHJpbmddJElzRGlyZWN0b3J5LCBbc3RyaW5nXSRTaXplLCBbc3RyaW5nXSROYW1lID0gW3JlZ2V4XTo6c3BsaXQoJExpbmUsICdeKFxkezJ9LVxkezJ9LVxkezJ9XHMrXGR7Mn06XGR7Mn1bQVBdTSlccys8KihbRElSXSopPipccysoXGQqKVxzKyguKykuKiQnLCAiU2luZ2xlTGluZSxJZ25vcmVDYXNlIikKICAgICAgICAgICAgICAgICN9CiAgICAgICAgICAgICAgICBpZiAoJE1vZGUgLWVxICJJSVM2IikgewogICAgICAgICAgICAgICAgICAgICR2YXIgPSAkTGluZS5zcGxpdCgiICIpIHwgRm9yRWFjaC1PYmplY3QgeyBpZiAoJF8gLW5lICIiKSB7IHJldHVybiAkXyB9IH0KICAgICAgICAgICAgICAgICAgICBbc3RyaW5nXSROZXdEYXRlID0gJHZhclswXSArICIgIiArICR2YXJbMV0gCiAgICAgICAgICAgICAgICAgICAgaWYgKCR2YXJbMl0gLWltYXRjaCAiRElSIikgewogICAgICAgICAgICAgICAgICAgICAgICBbc3RyaW5nXSRJc0RpcmVjdG9yeSA9ICR2YXJbMl0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFtzdHJpbmddJElzRGlyZWN0b3J5ID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgW3N0cmluZ10kU2l6ZSA9ICR2YXJbMl0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgW3N0cmluZ10kTmFtZSA9ICR2YXJbM10KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICgkUGFyZW50UGF0aCAtbWF0Y2ggIlwqfFw/IikgewogICAgICAgICAgICAgICAgICAgICRMYXN0SW5kZXggPSAkUGFyZW50UGF0aC5MYXN0SW5kZXhPZigiLyIpCiAgICAgICAgICAgICAgICAgICAgJFBhcmVudFBhdGggPSAkUGFyZW50UGF0aC5TdWJTdHJpbmcoMCwgJExhc3RJbmRleCkKICAgICAgICAgICAgICAgICAgICAkUGFyZW50UGF0aC5UcmltKCkgKyAiLyIgKyAkTmFtZS5UcmltKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRMaW5lT2JqID0gTmV3LU9iamVjdCBQU09iamVjdCAtUHJvcGVydHkgQHsKICAgICAgICAgICAgICAgICAgICBUeXBlICAgICAgICAgPSBpZiAoJElzRGlyZWN0b3J5IC1lcSAnJykgeyAnRmlsZScgfWVsc2UgeyAnRGlyZWN0b3J5JyB9CiAgICAgICAgICAgICAgICAgICAgUmlnaHQgICAgICAgID0gJEZsYWcKICAgICAgICAgICAgICAgICAgICBMbiAgICAgICAgICAgPSAkTGluawogICAgICAgICAgICAgICAgICAgIFVzZXIgICAgICAgICA9ICRVc2VyTmFtZQogICAgICAgICAgICAgICAgICAgIEdyb3VwICAgICAgICA9ICRHcm91cE5hbWUKICAgICAgICAgICAgICAgICAgICBTaXplICAgICAgICAgPSAkU2l6ZQogICAgICAgICAgICAgICAgICAgIE1vZGlmaWVkRGF0ZSA9ICROZXdEYXRlCiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgID0gJE5hbWUuVHJpbSgpCiAgICAgICAgICAgICAgICAgICAgRnVsbE5hbWUgICAgID0gJFBhcmVudFBhdGguVHJpbSgpICsgIi8iICsgJE5hbWUuVHJpbSgpCiAgICAgICAgICAgICAgICAgICAgUGFyZW50ICAgICAgID0gJFBhcmVudFBhdGguVHJpbSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoJFJlY3Vyc2UgLWFuZCAoJExpbmVPYmouVHlwZSAtZXEgJ0RpcmVjdG9yeScpKSB7CiAgICAgICAgICAgICAgICAgICAgJERpcmVjdG9yeUxpc3QgKz0gJExpbmVPYmoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICgkTGluZU9iai5UeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRMaW5lT2JqLk5hbWUgLWxpa2UgJEZpbHRlcikgewogICAgICAgICAgICAgICAgICAgICAgICAkSXRlbXNDb2xsZWN0aW9uICs9ICRMaW5lT2JqCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJExpbmUgPSAkU3RyZWFtLlJlYWRMaW5lKCkKICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICRSZXNwb25zZS5DbG9zZSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCRSZWN1cnNlIC1hbmQgKCRDdXJyZW50RGVwdGggLWx0ICRTY3JpcHQ6TWF4RGVwdGggLW9yICREZXB0aCAtZXEgMCkpIHsKICAgICAgICAgICAgICAgICRSZWN1cnNlUmVzdWx0ID0gQCgpCiAgICAgICAgICAgICAgICAkRGlyZWN0b3J5TGlzdCB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAkUmVjdXJzZVJlc3VsdCArPSBMaXN0RlRQSXRlbXMgLVBhdGggKCRfLkZ1bGxOYW1lKSAtQ3JlZGVudGlhbHMgJENyZWRlbnRpYWxzIC1SZWN1cnNlIC1GaWx0ZXIgJEZpbHRlciAtRGVwdGggJERlcHRoCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgfSAgICAKCiAgICAgICAgICAgICAgICAkSXRlbXNDb2xsZWN0aW9uICs9ICRSZWN1cnNlUmVzdWx0CiAgICAgICAgICAgIH0gICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCRJdGVtc0NvbGxlY3Rpb24uY291bnQgLWVxIDApIHsKICAgICAgICAgICAgICAgIFJldHVybiAKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIFJldHVybiAkSXRlbXNDb2xsZWN0aW9uIHwgU29ydC1PYmplY3QgLVByb3BlcnR5IEB7RXhwcmVzc2lvbiA9ICJQYXJlbnQiOyBEZXNjZW5kaW5nID0gJGZhbHNlIH0sIEB7RXhwcmVzc2lvbiA9ICJUeXBlIjsgRGVzY2VuZGluZyA9ICR0cnVlIH0sIEB7RXhwcmVzc2lvbiA9ICJOYW1lIjsgRGVzY2VuZGluZyA9ICRmYWxzZSB9IAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENhdGNoIHsKICAgICAgICAgICAgV3JpdGUtRXJyb3IgJF8uRXhjZXB0aW9uLk1lc3NhZ2UgLUVycm9yQWN0aW9uIFN0b3AgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICgkQ3VycmVudERlcHRoIC1nZSAkU2NyaXB0Ok1heERlcHRoKSB7CiAgICAgICAgICAgIFJlbW92ZS1WYXJpYWJsZSAtU2NvcGUgU2NyaXB0IC1OYW1lIEN1cnJlbnREZXB0aCAKICAgICAgICB9ICAgICAgICAKICAgIH0KfQoKRnVuY3Rpb24gR2V0RlRQSXRlbVNpemUgewogICAgUGFyYW0oCiAgICAgICAgW3BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgW1N0cmluZ10kUGF0aCA9ICIiLAogICAgICAgIFtTd2l0Y2hdJFNpbGVudCA9ICRGYWxzZSwKICAgICAgICAkQ3JlZGVudGlhbHMKICAgICkKICAgIFByb2Nlc3MgewogICAgICAgIGlmICghKCRQYXRoIC1tYXRjaCAiZnRwOi8vIikpIHsKICAgICAgICAgICAgJFBhdGggPSAiZnRwOi8vIiArICRQYXRoCiAgICAgICAgfQogICAgICAgICRQYXRoID0gW3JlZ2V4XTo6UmVwbGFjZSgkUGF0aCwgJy8kJywgJycpCiAgICAgICAgJFBhdGggPSBbcmVnZXhdOjpSZXBsYWNlKCRQYXRoLCAnLysnLCAnLycpCiAgICAgICAgJFBhdGggPSBbcmVnZXhdOjpSZXBsYWNlKCRQYXRoLCAnXmZ0cDovJywgJ2Z0cDovLycpCiAgICAgICAgICAgCiAgICAgICAgW1N5c3RlbS5OZXQuRnRwV2ViUmVxdWVzdF0kUmVxdWVzdCA9IFtTeXN0ZW0uTmV0LldlYlJlcXVlc3RdOjpDcmVhdGUoJFBhdGgpCiAgICAgICAgJFJlcXVlc3QuQ3JlZGVudGlhbHMgPSAkQ3JlZGVudGlhbHMKICAgICAgICAgICAgCiAgICAgICAgJFJlcXVlc3QuTWV0aG9kID0gW1N5c3RlbS5OZXQuV2ViUmVxdWVzdE1ldGhvZHMrRlRQXTo6R2V0RmlsZVNpemUgCiAgICAgICAgVHJ5IHsKICAgICAgICAgICAgJFJlc3BvbnNlID0gJFJlcXVlc3QuR2V0UmVzcG9uc2UoKQogICAgICAgICAgICAkTGVuZ3RoID0gJFJlc3BvbnNlLkNvbnRlbnRMZW5ndGgKICAgICAgICAgICAgJFJlc3BvbnNlLkNsb3NlKCkKICAgICAgICAgICAgUmV0dXJuICRMZW5ndGgKICAgICAgICB9CiAgICAgICAgQ2F0Y2ggewogICAgICAgICAgICBpZiAoISRTaWxlbnQpIHsKICAgICAgICAgICAgICAgIFdyaXRlLUVycm9yICRfLkV4Y2VwdGlvbi5NZXNzYWdlIC1FcnJvckFjdGlvbiBTdG9wICAKICAgICAgICAgICAgfSAgICAKICAgICAgICAgICAgUmV0dXJuIC0xCiAgICAgICAgfQogICAgfSAgICAgICAgICAgCn0KCkZ1bmN0aW9uIERvd25sb2FkRnRwRGlyZWN0b3J5IHsKICAgIFBhcmFtKAogICAgICAgIFtTdHJpbmddJFBhdGggPSAiIiwKICAgICAgICBbU3RyaW5nXSRsb2NhbFBhdGgsCiAgICAgICAgJENyZWRlbnRpYWxzLAogICAgICAgIFtTd2l0Y2hdJFJlY3Vyc2UsICAgIAogICAgICAgIFtJbnRdJERlcHRoID0gMCwgICAgICAgIAogICAgICAgIFtTdHJpbmddJEZpbHRlciA9ICIqIgogICAgKQogICAgJFJlc3VsdCA9IExpc3RGVFBJdGVtcyAtUGF0aCAkUGF0aCAtQ3JlZGVudGlhbHMgJGNyZWRlbnRpYWxzIC1SZWN1cnNlOiRSZWN1cnNlIC1EZXB0aCAkRGVwdGggLUZpbHRlciAkRmlsdGVyCiAgCiAgICBGb3JlYWNoICgkaXRlbSBpbiAkcmVzdWx0KSB7CiAgICAgICAgJGxvY2FsRmlsZVBhdGggPSBKb2luLVBhdGggJGxvY2FsUGF0aCAkKCgkSXRlbS5mdWxsbmFtZSAtcmVwbGFjZSAkUGF0aCkudHJpbSgpKQogICAgICAgIAogICAgICAgICMgV3JpdGUtSG9zdCAiYCRsb2NhbEZpbGVQYXRoOiAgJGxvY2FsRmlsZVBhdGgiIC1mb3JlIGJsdWUKCiAgICAgICAgaWYgKCgkSXRlbS5UeXBlIC1lcSAnRGlyZWN0b3J5JykgLWFuZCAkUmVjdXJzZSkgewogICAgICAgICAgICAjIG5hbWUgd2l0aCBubyBmaWxlIGV4dGVuc2lvbiBpcyBjb25zaWRlcmVkIGEgZGlyZWN0b3J5CiAgICAgICAgICAgIGlmICghKFRlc3QtUGF0aCAkbG9jYWxGaWxlUGF0aCAtUGF0aFR5cGUgY29udGFpbmVyKSkgewogICAgICAgICAgICAgICAgIyBXcml0ZS1Ib3N0ICJDcmVhdGluZyBkaXJlY3RvcnkgJGxvY2FsRmlsZVBhdGgiCiAgICAgICAgICAgICAgICBOZXctSXRlbSAkbG9jYWxGaWxlUGF0aCAtVHlwZSBkaXJlY3RvcnkgfCBPdXQtTnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgICNEb3dubG9hZEZ0cERpcmVjdG9yeSAtUGF0aCAoJEl0ZW0uRnVsbE5hbWUgKyAiLyIpICAtQ3JlZGVudGlhbHMgJGNyZWRlbnRpYWxzIC1sb2NhbFBhdGggJCgkbG9jYWxGaWxlUGF0aCkKICAgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIGVsc2VpZiAoJGl0ZW0uVHlwZSAtZXEgJ0ZpbGUnKSB7CgogICAgICAgICAgICBEb3dubG9hZEZUUEZpbGUgLVBhdGggJEl0ZW0uRnVsbE5hbWUgLWxvY2FsUGF0aCAkbG9jYWxGaWxlUGF0aCAtQ3JlZGVudGlhbHMgJENyZWRlbnRpYWxzCiAgICAgICAgfQogICAgfQp9CgpGdW5jdGlvbiBEb3dubG9hZEZUUEZpbGUgewogICAgUGFyYW0oCiAgICAgICAgW1N0cmluZ10kUGF0aCA9ICIiLAogICAgICAgIFtTdHJpbmddJGxvY2FsUGF0aCwKICAgICAgICAkQ3JlZGVudGlhbHMKICAgICkKICAgICMgV3JpdGUtSG9zdCAiRG93bmxvYWRpbmcgJFBhdGggdG8gJGxvY2FsUGF0aCIKICAgICRkb3dubG9hZFJlcXVlc3QgPSBbTmV0LldlYlJlcXVlc3RdOjpDcmVhdGUoJFBhdGgpCiAgICAkZG93bmxvYWRSZXF1ZXN0Lk1ldGhvZCA9IFtTeXN0ZW0uTmV0LldlYlJlcXVlc3RNZXRob2RzK0Z0cF06OkRvd25sb2FkRmlsZQogICAgJGRvd25sb2FkUmVxdWVzdC5DcmVkZW50aWFscyA9ICRjcmVkZW50aWFscwogICAgCiAgICAkZG93bmxvYWRSZXNwb25zZSA9ICRkb3dubG9hZFJlcXVlc3QuR2V0UmVzcG9uc2UoKQogICAgJHNvdXJjZVN0cmVhbSA9ICRkb3dubG9hZFJlc3BvbnNlLkdldFJlc3BvbnNlU3RyZWFtKCkKICAgICR0YXJnZXRTdHJlYW0gPSBbU3lzdGVtLklPLkZpbGVdOjpDcmVhdGUoJGxvY2FsUGF0aCkKICAgICRidWZmZXIgPSBOZXctT2JqZWN0IGJ5dGVbXSAxMDI0MAogICAgd2hpbGUgKCgkcmVhZCA9ICRzb3VyY2VTdHJlYW0uUmVhZCgkYnVmZmVyLCAwLCAkYnVmZmVyLkxlbmd0aCkpIC1ndCAwKSB7CiAgICAgICAgJHRhcmdldFN0cmVhbS5Xcml0ZSgkYnVmZmVyLCAwLCAkcmVhZCk7CiAgICB9CiAgICAkdGFyZ2V0U3RyZWFtLkRpc3Bvc2UoKQogICAgJHNvdXJjZVN0cmVhbS5EaXNwb3NlKCkKfQoKZnVuY3Rpb24gSm9pbi1VUkxQYXJ0cyB7CiAgICBwYXJhbSAoW3N0cmluZ1tdXSAkUGFydHMsIFtzdHJpbmddICRTZXBlcmF0b3IgPSAnJykKICAgICRzZWFyY2ggPSAnKD88ITopJyArIFtyZWdleF06OkVzY2FwZSgkU2VwZXJhdG9yKSArICcrJyAgI1JlcGxhY2UgbXVsdGlwbGVzIGV4Y2VwdCBpbiBmcm9udCBvZiBhIGNvbG9uIGZvciBVUkxzLgogICAgJHJlcGxhY2UgPSAkU2VwZXJhdG9yCiAgICAoJFBhcnRzIHwgV2hlcmUtT2JqZWN0IHsgJF8gLWFuZCAkXy5UcmltKCkuTGVuZ3RoIH0pIC1qb2luICRTZXBlcmF0b3IgLXJlcGxhY2UgJHNlYXJjaCwgJHJlcGxhY2UKfQoKZnVuY3Rpb24gR2V0LU1ENUhhc2ggKCRwYXRoKSB7CiAgICAkbWQ1ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLlNlY3VyaXR5LkNyeXB0b2dyYXBoeS5NRDVDcnlwdG9TZXJ2aWNlUHJvdmlkZXIKICAgIHJldHVybiBbU3lzdGVtLkJpdENvbnZlcnRlcl06OlRvU3RyaW5nKCRtZDUuQ29tcHV0ZUhhc2goW1N5c3RlbS5JTy5GaWxlXTo6UmVhZEFsbEJ5dGVzKCRwYXRoKSkpIC1yZXBsYWNlICctJywgJycKfQoKZnVuY3Rpb24gVGVzdC1SZWdpc3RyeSAoJEtleSwgJFZhbHVlLCAkRGF0YSkgewogICAgJFBhdGggPSAiUkVHSVNUUlk6OiRrZXkiCiAgICAkS2V5RXhpc3RzID0gVGVzdC1QYXRoICRQYXRoCiAgICAkUmVzdWx0ID0gR2V0LUl0ZW1Qcm9wZXJ0eSAiUkVHSVNUUlk6OiRrZXkiIC1OYW1lICRWYWx1ZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgJFZhbHVlRXhpc3RzID0gW2Jvb2xdKCgkUmVzdWx0KS4kdmFsdWUpCiAgICAkRGF0YU1hdGNoZXMgPSAkZGF0YSAtZXEgKCRSZXN1bHQpLiR2YWx1ZQoKICAgIHJldHVybiAkS2V5RXhpc3RzLCAkVmFsdWVFeGlzdHMsICREYXRhTWF0Y2hlcwp9CgpmdW5jdGlvbiBUZXN0LUZpbGVWZXJzaW9uICgkUGF0aCwgW1N5c3RlbS5WZXJzaW9uXSRVc2VyU3BlY2lmaWVkVmVyc2lvbikgeyAKICAgICRGaWxlRXhpc3RzID0gVGVzdC1QYXRoICRQYXRoCiAgICAkRmlsZVZlcnNpb24gPSAoR2V0LUl0ZW0gJFBhdGggLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpLnZlcnNpb25pbmZvLmZpbGV2ZXJzaW9uCiAgICAkRmlsZVZlcnNpb25NYXRjaGVzID0gJEZpbGVWZXJzaW9uIC1lcSAkVXNlclNwZWNpZmllZFZlcnNpb24KICAgICRGaWxlVmVyc2lvbkdyZWF0ZXIgPSAkRmlsZVZlcnNpb24gLWd0ICRVc2VyU3BlY2lmaWVkVmVyc2lvbgogICAgJEZpbGVWZXJzaW9uTG93ZXIgPSAkRmlsZVZlcnNpb24gLWx0ICRVc2VyU3BlY2lmaWVkVmVyc2lvbgoKICAgIHJldHVybiAkRmlsZUV4aXN0cywgJEZpbGVWZXJzaW9uTWF0Y2hlcywgJEZpbGVWZXJzaW9uR3JlYXRlciwgJEZpbGVWZXJzaW9uTG93ZXIKfQojZW5kcmVnaW9uIEZ1bmN0aW9ucwoKdHJ5IHsKICAgICRFcnJvckFjdGlvblByZWZlcmVuY2UgPSAnU3RvcCcKCiAgICAjcmVnaW9uIFByZUNoZWNrCiAgICBpZiAoJFBlcmZvcm1QcmVDaGVjaykgewogICAgICAgICROYW1lID0gJ1ByZS1DaGVjaycKICAgICAgICBTd2l0Y2ggKCRQcmVDaGVja1R5cGUpIHsKICAgICAgICAgICAgJ0NoZWNrIGlmIGZpbGUgZXhpc3RzJyB7CiAgICAgICAgICAgICAgICAkRmlsZUV4aXN0cyA9IFRlc3QtUGF0aCAkUHJlQ2hlY2tGaWxlTmFtZQogICAgICAgICAgICAgICAgU3dpdGNoICgkUHJlQ2hlY2tBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAnSWYgZmlsZSBleGlzdHMgdGhlbiBDb250aW51ZScgeyBpZiAoJEZpbGVFeGlzdHMpIHsgY29udGludWUgfSBlbHNlIHsgV3JpdGUtRXJyb3IgIkFib3J0aW5nIGJlY2F1c2UgJE5hbWUgY29uZGl0aW9uIHdhcyBub3QgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfSB9CiAgICAgICAgICAgICAgICAgICAgJ0lmIGZpbGUgZG9lcyBub3QgZXhpc3RzIHRoZW4gQ29udGludWUnIHsgaWYgKC1ub3QgJEZpbGVFeGlzdHMpIHsgY29udGludWUgfSBlbHNlIHsgV3JpdGUtRXJyb3IgIkFib3J0aW5nIGJlY2F1c2UgJE5hbWUgY29uZGl0aW9uIHdhcyBub3QgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfSB9CiAgICAgICAgICAgICAgICAgICAgJ0lmIGZpbGUgZXhpc3RzIHRoZW4gQWJvcnQnIHsgaWYgKCRGaWxlRXhpc3RzKSB7IFdyaXRlLU91dHB1dCAiQWJvcnRpbmcgYmVjYXVzZSAkTmFtZSBjb25kaXRpb24gd2FzIG1ldCBgJyRQcmVDaGVja0FjdGlvbmAnIjsgcmV0dXJuIH0gZWxzZSB7IGNvbnRpbnVlIH0gfQogICAgICAgICAgICAgICAgICAgICdJZiBmaWxlIGRvZXMgbm90IGV4aXN0cyB0aGVuIEFib3J0JyB7IGlmICgtbm90ICRGaWxlRXhpc3RzKSB7IFdyaXRlLUVycm9yICJBYm9ydGluZyBiZWNhdXNlICROYW1lIGNvbmRpdGlvbiB3YXMgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfSBlbHNlIHsgY29udGludWUgfSB9CiAgICAgICAgICAgICAgICAgICAgJ0lmIGZpbGUgZXhpc3RzIGFuZCBNRDUgY2hlY2tzdW0gbWF0Y2hlcyB0aGVuIENvbnRpbnVlJyB7IAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJFByZUNoZWNrTUQ1Q2hlY2tzdW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkRmlsZUV4aXN0cyAtYW5kICgoR2V0LU1ENUhhc2ggJFByZUNoZWNrRmlsZU5hbWUpIC1lcSAkUHJlQ2hlY2tNRDVDaGVja3N1bSkpIHsgY29udGludWUgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7IFdyaXRlLUVycm9yICJBYm9ydGluZyBiZWNhdXNlICROYW1lIGNvbmRpdGlvbiB3YXMgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyBXcml0ZS1FcnJvciAiUGxlYXNlIHByb3ZpZGUgYSBNRDUgQ2hlY2tzdW0gdG8gdmFsaWRhdGUgdGhlICROYW1lIGNvbmRpdGlvbiIgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAnSWYgZmlsZSBleGlzdHMgYW5kIE1ENSBjaGVja3N1bSBkb2VzIG5vdCBtYXRjaGVzIHRoZW4gQ29udGludWUnIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkUHJlQ2hlY2tNRDVDaGVja3N1bSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRGaWxlRXhpc3RzIC1hbmQgISgoR2V0LU1ENUhhc2ggJFByZUNoZWNrRmlsZU5hbWUpIC1lcSAkUHJlQ2hlY2tNRDVDaGVja3N1bSkpIHsgY29udGludWUgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7IFdyaXRlLUVycm9yICJBYm9ydGluZyBiZWNhdXNlICROYW1lIGNvbmRpdGlvbiB3YXMgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyBXcml0ZS1FcnJvciAiUGxlYXNlIHByb3ZpZGUgYSBNRDUgQ2hlY2tzdW0gdG8gdmFsaWRhdGUgdGhlICROYW1lIGNvbmRpdGlvbiIgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAnSWYgZmlsZSBleGlzdHMgYW5kIE1ENSBjaGVja3N1bSBtYXRjaGVzIHRoZW4gQWJvcnQnIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkUHJlQ2hlY2tNRDVDaGVja3N1bSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRGaWxlRXhpc3RzIC1hbmQgKChHZXQtTUQ1SGFzaCAkUHJlQ2hlY2tGaWxlTmFtZSkgLWVxICRQcmVDaGVja01ENUNoZWNrc3VtKSkgeyBXcml0ZS1PdXRwdXQgIkFib3J0aW5nIGJlY2F1c2UgJE5hbWUgY29uZGl0aW9uIHdhcyBtZXQgYCckUHJlQ2hlY2tBY3Rpb25gJyI7IHJldHVybiB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsgY29udGludWUgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyBXcml0ZS1FcnJvciAiUGxlYXNlIHByb3ZpZGUgYSBNRDUgQ2hlY2tzdW0gdG8gdmFsaWRhdGUgdGhlICROYW1lIGNvbmRpdGlvbiIgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAnSWYgZmlsZSBleGlzdHMgYW5kIE1ENSBjaGVja3N1bSBkb2VzIG5vdCBtYXRjaGVzIHRoZW4gQWJvcnQnIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkUHJlQ2hlY2tNRDVDaGVja3N1bSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRGaWxlRXhpc3RzIC1hbmQgISgoR2V0LU1ENUhhc2ggJFByZUNoZWNrRmlsZU5hbWUpIC1lcSAkUHJlQ2hlY2tNRDVDaGVja3N1bSkpIHsgV3JpdGUtT3V0cHV0ICJBYm9ydGluZyBiZWNhdXNlICROYW1lIGNvbmRpdGlvbiB3YXMgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7IGNvbnRpbnVlIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsgV3JpdGUtRXJyb3IgIlBsZWFzZSBwcm92aWRlIGEgTUQ1IENoZWNrc3VtIHRvIHZhbGlkYXRlIHRoZSAkTmFtZSBjb25kaXRpb24iIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAnQ2hlY2sgaWYgcmVnaXN0cnkgaW5mb3JtYXRpb24gZXhpc3RzJyB7CiAgICAgICAgICAgICAgICAkS2V5RXhpc3RzLCAkVmFsdWVNYXRjaGVzLCAkRGF0YU1hdGNoZXMgPSBUZXN0LVJlZ2lzdHJ5IC1LZXkgJFByZUNoZWNrS2V5IC1WYWx1ZSAkUHJlQ2hlY2tWYWx1ZSAtRGF0YSAkUHJlQ2hlY2tEYXRhCiAgICAgICAgICAgICAgICBTd2l0Y2ggKCRQcmVDaGVja0FjdGlvbikgewogICAgICAgICAgICAgICAgICAgICdJZiBrZXkgZXhpc3RzIHRoZW4gQ29udGludWUnIHsgaWYgKCRLZXlFeGlzdHMpIHsgY29udGludWUgfSBlbHNlIHsgV3JpdGUtRXJyb3IgIkFib3J0aW5nIGJlY2F1c2UgJE5hbWUgY29uZGl0aW9uIHdhcyBub3QgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfSB9CiAgICAgICAgICAgICAgICAgICAgJ0lmIGtleSBkb2VzIG5vdCBleGlzdHMgdGhlbiBDb250aW51ZScgeyBpZiAoLW5vdCAkS2V5RXhpc3RzKSB7IGNvbnRpbnVlIH0gZWxzZSB7IFdyaXRlLUVycm9yICJBYm9ydGluZyBiZWNhdXNlICROYW1lIGNvbmRpdGlvbiB3YXMgbm90IG1ldCBgJyRQcmVDaGVja0FjdGlvbmAnIjsgcmV0dXJuIH0gfQogICAgICAgICAgICAgICAgICAgICdJZiBrZXkgZXhpc3RzIHRoZW4gQWJvcnQnIHsgaWYgKCRLZXlFeGlzdHMpIHsgV3JpdGUtT3V0cHV0ICJBYm9ydGluZyBiZWNhdXNlICROYW1lIGNvbmRpdGlvbiB3YXMgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfSBlbHNlIHsgY29udGludWUgfSB9CiAgICAgICAgICAgICAgICAgICAgJ0lmIGtleSBub3QgZXhpc3RzIHRoZW4gQWJvcnQnIHsgaWYgKC1ub3QgJEtleUV4aXN0cykgeyBXcml0ZS1PdXRwdXQgIkFib3J0aW5nIGJlY2F1c2UgJE5hbWUgY29uZGl0aW9uIHdhcyBtZXQgYCckUHJlQ2hlY2tBY3Rpb25gJyI7IHJldHVybiB9IGVsc2UgeyBjb250aW51ZSB9IH0KICAgICAgICAgICAgICAgICAgICAnSWYga2V5IGV4aXN0cyBhbmQgdmFsdWUgbWF0Y2hlcyB0aGVuIENvbnRpbnVlJyB7IGlmICgkS2V5RXhpc3RzIC1hbmQgJFZhbHVlTWF0Y2hlcykgeyBjb250aW51ZSB9IGVsc2UgeyBXcml0ZS1FcnJvciAiQWJvcnRpbmcgYmVjYXVzZSAkTmFtZSBjb25kaXRpb24gd2FzIG5vdCBtZXQgYCckUHJlQ2hlY2tBY3Rpb25gJyI7IHJldHVybiB9IH0KICAgICAgICAgICAgICAgICAgICAnSWYga2V5IGV4aXN0cyBhbmQgdmFsdWUgZG9lcyBub3QgbWF0Y2hlcyB0aGVuIENvbnRpbnVlJyB7IGlmICgkS2V5RXhpc3RzIC1hbmQgKC1ub3QgJFZhbHVlTWF0Y2hlcykpIHsgY29udGludWUgfSBlbHNlIHsgV3JpdGUtRXJyb3IgIkFib3J0aW5nIGJlY2F1c2UgJE5hbWUgY29uZGl0aW9uIHdhcyBub3QgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfSB9CiAgICAgICAgICAgICAgICAgICAgJ0lmIGtleSBleGlzdHMgYW5kIHZhbHVlIG1hdGNoZXMgdGhlbiBBYm9ydCcgeyBpZiAoJEtleUV4aXN0cyAtYW5kICRWYWx1ZU1hdGNoZXMpIHsgV3JpdGUtT3V0cHV0ICJBYm9ydGluZyBiZWNhdXNlICROYW1lIGNvbmRpdGlvbiB3YXMgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfSBlbHNlIHsgY29udGludWUgfSB9CiAgICAgICAgICAgICAgICAgICAgJ0lmIGtleSBleGlzdHMgYW5kIHZhbHVlIGRvZXMgbm90IG1hdGNoZXMgdGhlbiBBYm9ydCcgeyBpZiAoJEtleUV4aXN0cyAtYW5kICgtbm90ICRWYWx1ZU1hdGNoZXMpKSB7IFdyaXRlLU91dHB1dCAiQWJvcnRpbmcgYmVjYXVzZSAkTmFtZSBjb25kaXRpb24gd2FzIG1ldCBgJyRQcmVDaGVja0FjdGlvbmAnIjsgcmV0dXJuIH0gZWxzZSB7IGNvbnRpbnVlIH0gfQogICAgICAgICAgICAgICAgICAgICdJZiBrZXkgZXhpc3RzIGFuZCB2YWx1ZSBleGlzdHMgYW5kIGRhdGEgbWF0Y2hlcyB0aGVuIENvbnRpbnVlJyB7IGlmICgkS2V5RXhpc3RzIC1hbmQgJGRhdGFtYXRjaGVzKSB7IGNvbnRpbnVlIH0gZWxzZSB7IFdyaXRlLUVycm9yICJBYm9ydGluZyBiZWNhdXNlICROYW1lIGNvbmRpdGlvbiB3YXMgbm90IG1ldCBgJyRQcmVDaGVja0FjdGlvbmAnIjsgcmV0dXJuIH0gfQogICAgICAgICAgICAgICAgICAgICdJZiBrZXkgZXhpc3RzIGFuZCB2YWx1ZSBleGlzdHMgYW5kIGRhdGEgZG9lcyBub3QgbWF0Y2hlcyB0aGVuIENvbnRpbnVlJyB7IGlmICgkS2V5RXhpc3RzIC1hbmQgJFZhbHVlTWF0Y2hlcyAtYW5kICgtbm90ICRkYXRhbWF0Y2hlcykpIHsgY29udGludWUgfSBlbHNlIHsgV3JpdGUtRXJyb3IgIkFib3J0aW5nIGJlY2F1c2UgJE5hbWUgY29uZGl0aW9uIHdhcyBub3QgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfSB9CiAgICAgICAgICAgICAgICAgICAgJ0lmIGtleSBleGlzdHMgYW5kIHZhbHVlIGV4aXN0cyBhbmQgZGF0YSBtYXRjaGVzIHRoZW4gQWJvcnQnIHsgaWYgKCRLZXlFeGlzdHMgLWFuZCAkVmFsdWVNYXRjaGVzIC1hbmQgJGRhdGFtYXRjaGVzKSB7IFdyaXRlLU91dHB1dCAiQWJvcnRpbmcgYmVjYXVzZSAkTmFtZSBjb25kaXRpb24gd2FzIG1ldCBgJyRQcmVDaGVja0FjdGlvbmAnIjsgcmV0dXJuIH0gZWxzZSB7IGNvbnRpbnVlIH0gfQogICAgICAgICAgICAgICAgICAgICdJZiBrZXkgZXhpc3RzIGFuZCB2YWx1ZSBleGlzdHMgYW5kIGRhdGEgZG9lcyBub3QgbWF0Y2hlcyB0aGVuIEFib3J0JyB7IGlmICgkS2V5RXhpc3RzIC1hbmQgJFZhbHVlTWF0Y2hlcyAtYW5kICgtbm90ICRkYXRhbWF0Y2hlcykpIHsgV3JpdGUtT3V0cHV0ICJBYm9ydGluZyBiZWNhdXNlICROYW1lIGNvbmRpdGlvbiB3YXMgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfSBlbHNlIHsgY29udGludWUgfSB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAnQ2hlY2sgZm9yIGZpbGUgdmVyc2lvbicgewogICAgICAgICAgICAgICAgJEZpbGVFeGlzdHMsICRGaWxlVmVyc2lvbk1hdGNoZXMsICRGaWxlVmVyc2lvbkdyZWF0ZXIsICRGaWxlVmVyc2lvbkxvd2VyID0gVGVzdC1GaWxlVmVyc2lvbiAtUGF0aCAkUHJlQ2hlY2tGaWxlTmFtZSAtVXNlclNwZWNpZmllZFZlcnNpb24gJFByZUNoZWNrVmVyc2lvbgogICAgICAgICAgICAgICAgU3dpdGNoICgkUHJlQ2hlY2tBY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAnSWYgZmlsZSBleGlzdHMgYW5kIHZlcnNpb24gZXF1YWwgdG8gc3BlY2lmaWVkIHRoZW4gQ29udGludWUnIHsgaWYgKCRGaWxlRXhpc3RzIC1hbmQgJEZpbGVWZXJzaW9uTWF0Y2hlcykgeyBjb250aW51ZSB9IGVsc2UgeyBXcml0ZS1FcnJvciAiQWJvcnRpbmcgYmVjYXVzZSAkTmFtZSBjb25kaXRpb24gd2FzIG5vdCBtZXQgYCckUHJlQ2hlY2tBY3Rpb25gJyI7IHJldHVybiB9IH0KICAgICAgICAgICAgICAgICAgICAnSWYgZmlsZSBleGlzdHMgYW5kIHZlcnNpb24gbm90IGVxdWFsIHRvIHNwZWNpZmllZCB0aGVuIENvbnRpbnVlJyB7IGlmICgkRmlsZUV4aXN0cyAtYW5kICgtbm90ICRGaWxlVmVyc2lvbk1hdGNoZXMpKSB7IGNvbnRpbnVlIH0gZWxzZSB7IFdyaXRlLUVycm9yICJBYm9ydGluZyBiZWNhdXNlICROYW1lIGNvbmRpdGlvbiB3YXMgbm90IG1ldCBgJyRQcmVDaGVja0FjdGlvbmAnIjsgcmV0dXJuIH0gfQogICAgICAgICAgICAgICAgICAgICdJZiBmaWxlIGV4aXN0cyBhbmQgdmVyc2lvbiBoaWdoZXIgdG8gc3BlY2lmaWVkIHRoZW4gQ29udGludWUnIHsgaWYgKCRGaWxlRXhpc3RzIC1hbmQgJEZpbGVWZXJzaW9uR3JlYXRlcikgeyBjb250aW51ZSB9IGVsc2UgeyBXcml0ZS1FcnJvciAiQWJvcnRpbmcgYmVjYXVzZSAkTmFtZSBjb25kaXRpb24gd2FzIG5vdCBtZXQgYCckUHJlQ2hlY2tBY3Rpb25gJyI7IHJldHVybiB9IH0KICAgICAgICAgICAgICAgICAgICAnSWYgZmlsZSBleGlzdHMgYW5kIHZlcnNpb24gbG93ZXIgdG8gc3BlY2lmaWVkIHRoZW4gQ29udGludWUnIHsgaWYgKCRGaWxlRXhpc3RzIC1hbmQgJEZpbGVWZXJzaW9uTG93ZXIpIHsgY29udGludWUgfSBlbHNlIHsgV3JpdGUtRXJyb3IgIkFib3J0aW5nIGJlY2F1c2UgJE5hbWUgY29uZGl0aW9uIHdhcyBub3QgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfSB9CiAgICAgICAgICAgICAgICAgICAgJ0lmIGZpbGUgZXhpc3RzIGFuZCB2ZXJzaW9uIGVxdWFsIHRvIHNwZWNpZmllZCB0aGVuIEFib3J0JyB7IGlmICgkRmlsZUV4aXN0cyAtYW5kICRGaWxlVmVyc2lvbk1hdGNoZXMpIHsgV3JpdGUtT3V0cHV0ICJBYm9ydGluZyBiZWNhdXNlICROYW1lIGNvbmRpdGlvbiB3YXMgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfSBlbHNlIHsgY29udGludWUgfSB9CiAgICAgICAgICAgICAgICAgICAgJ0lmIGZpbGUgZXhpc3RzIGFuZCB2ZXJzaW9uIG5vdCBlcXVhbCB0byBzcGVjaWZpZWQgdGhlbiBBYm9ydCcgeyBpZiAoJEZpbGVFeGlzdHMgLWFuZCAoLW5vdCAkRmlsZVZlcnNpb25NYXRjaGVzKSkgeyBXcml0ZS1PdXRwdXQgIkFib3J0aW5nIGJlY2F1c2UgJE5hbWUgY29uZGl0aW9uIHdhcyBtZXQgYCckUHJlQ2hlY2tBY3Rpb25gJyI7IHJldHVybiB9IGVsc2UgeyBjb250aW51ZSB9IH0KICAgICAgICAgICAgICAgICAgICAnSWYgZmlsZSBleGlzdHMgYW5kIHZlcnNpb24gaGlnaGVyIHRvIHNwZWNpZmllZCB0aGVuIEFib3J0JyB7IGlmICgkRmlsZUV4aXN0cyAtYW5kICRGaWxlVmVyc2lvbkdyZWF0ZXIpIHsgV3JpdGUtT3V0cHV0ICJBYm9ydGluZyBiZWNhdXNlICROYW1lIGNvbmRpdGlvbiB3YXMgbWV0IGAnJFByZUNoZWNrQWN0aW9uYCciOyByZXR1cm4gfSBlbHNlIHsgY29udGludWUgfSB9CiAgICAgICAgICAgICAgICAgICAgJ0lmIGZpbGUgZXhpc3RzIGFuZCB2ZXJzaW9uIGxvd2VyIHRvIHNwZWNpZmllZCB0aGVuIEFib3J0JyB7IGlmICgkRmlsZUV4aXN0cyAtYW5kICRGaWxlVmVyc2lvbkxvd2VyKSB7IFdyaXRlLU91dHB1dCAiQWJvcnRpbmcgYmVjYXVzZSAkTmFtZSBjb25kaXRpb24gd2FzIG1ldCBgJyRQcmVDaGVja0FjdGlvbmAnIjsgcmV0dXJuIH0gZWxzZSB7IGNvbnRpbnVlIH0gfQogICAgICAgICAgICAgICAgICAgICdJZiBmaWxlIGRvZXMgbm90IGV4aXN0cyB0aGVuIEFib3J0JyB7IGlmICgtbm90ICRGaWxlRXhpc3RzKSB7IFdyaXRlLU91dHB1dCAiQWJvcnRpbmcgYmVjYXVzZSAkTmFtZSBjb25kaXRpb24gd2FzIG1ldCBgJyRQcmVDaGVja0FjdGlvbmAnIjsgcmV0dXJuIH0gZWxzZSB7IGNvbnRpbnVlIH0gfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAjZW5kcmVnaW9uIFByZWNoZWNrCiAgICAKICAgICNyZWdpb24gTWFpbgogCiAgICAjIHZhbGlkYXRlIGNvbm5lY3Rpb24gYW5kIHNvdXJjZSBzdHJpbmcKICAgIGlmICghKCRDb25uZWN0aW9uUGF0aCAtbWF0Y2ggImZ0cDovLyIpKSB7ICRDb25uZWN0aW9uUGF0aCA9ICJmdHA6Ly8iICsgJENvbm5lY3Rpb25QYXRoIH0KICAgICRTb3VyY2UgPSAkU291cmNlLlRyaW1TdGFydCgnXCcpLlRyaW1FbmQoJ1wnKSAtcmVwbGFjZSAnXFwnLCAnLycKCiAgICAjIGJ1aWxkIGNyZWRlbnRpYWxzIGFuZCBzb3VyY2UgVVJMCiAgICAkY3JlZGVudGlhbHMgPSBOZXctT2JqZWN0IFN5c3RlbS5OZXQuTmV0d29ya0NyZWRlbnRpYWwoJHVzZXJuYW1lLCAkcGFzc3dvcmQpIAogICAgJFVybCA9IEpvaW4tVVJMUGFydHMgLVBhcnRzICQoJENvbm5lY3Rpb25QYXRoLCAkU291cmNlKSAtU2VwZXJhdG9yICcvJwoKICAgICMgdmFsaWRhdGUgZGVzdGluYXRpb24gZm9sZGVyCiAgICBpZiAoISQoVGVzdC1QYXRoICREZXN0aW5hdGlvbikgLWFuZCAoJENyZWF0ZURlc3RpbmF0aW9uRm9sZGVyIC1lcSAkZmFsc2UpKSB7CiAgICAgICAgV3JpdGUtRXJyb3IgIk5vdCBhIHZhbGlkIGZvbGRlciBwYXRoOiAkRGVzdGluYXRpb24iOwogICAgICAgIGV4aXQ7CiAgICB9CiAgICAjIGNyZWF0ZSBkZXN0aW5hdGlvbiBkaXJlY3RvcnkKICAgIGlmICgkQ3JlYXRlRGVzdGluYXRpb25Gb2xkZXIgLWFuZCAhJChUZXN0LVBhdGggJERlc3RpbmF0aW9uKSkgewogICAgICAgIE5ldy1JdGVtICREZXN0aW5hdGlvbiAtVHlwZSBkaXJlY3RvcnkgfCBPdXQtTnVsbAogICAgfQoKICAgIGlmIChUZXN0LVBhdGggJERlc3RpbmF0aW9uKSB7CiAgICAgICAgIyB2YWxpZGF0ZSBkZXN0aW5hdGlvbiBmb2xkZXIKICAgICAgICBpZiAoISgoR2V0LUl0ZW0gJERlc3RpbmF0aW9uIC1FcnJvckFjdGlvbiBzaWxlbnRseWNvbnRpbnVlKSAtaXMgW1N5c3RlbS5JTy5EaXJlY3RvcnlJbmZvXSkpIHsgV3JpdGUtRXJyb3IgIk5vdCBhIHZhbGlkIGZvbGRlciBwYXRoOiAkRGVzdGluYXRpb24iOyBicmVhazsgfQogICAgICAgIFN3aXRjaCAoJFR5cGUpIHsKICAgICAgICAgICAgJ0ZvbGRlcicgewogICAgICAgICAgICAgICAgRG93bmxvYWRGdHBEaXJlY3RvcnkgLVBhdGggJFVybCAtQ3JlZGVudGlhbHMgJGNyZWRlbnRpYWxzIC1SZWN1cnNlOiRSZWN1cnNlIC1sb2NhbFBhdGggJERlc3RpbmF0aW9uICN8IEZvcm1hdC1UYWJsZSAtQXV0b1NpemUKICAgICAgICAgICAgICAgICRzdGF0dXMgPSAkPwogICAgICAgICAgICAgICAgaWYgKCEkUGVyZm9ybVBvc3RDaGVjaykgewogICAgICAgICAgICAgICAgICAgIGlmICgkU3RhdHVzKSB7IFdyaXRlLU91dHB1dCAnRlRQIERvd25sb2FkIFN1Y2Nlc3NmdWwnIH1lbHNlIHsgV3JpdGUtRXJyb3IgJ0ZUUCBEb3dubG9hZCBGYWlsZWQnIH0KICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgICdGaWxlJyB7CiAgICAgICAgICAgICAgICBEb3dubG9hZEZ0cEZpbGUgLVBhdGggJFVybCAtQ3JlZGVudGlhbHMgJGNyZWRlbnRpYWxzIC1sb2NhbFBhdGggJChKb2luLVBhdGggJERlc3RpbmF0aW9uICQoU3BsaXQtUGF0aCAkU291cmNlIC1MZWFmKSkKICAgICAgICAgICAgICAgICRzdGF0dXMgPSAkPwogICAgICAgICAgICAgICAgaWYgKCEkUGVyZm9ybVBvc3RDaGVjaykgewogICAgICAgICAgICAgICAgICAgIGlmICgkU3RhdHVzKSB7IFdyaXRlLU91dHB1dCAnRlRQIERvd25sb2FkIFN1Y2Nlc3NmdWwnIH1lbHNlIHsgV3JpdGUtRXJyb3IgJ0ZUUCBEb3dubG9hZCBGYWlsZWQnIH0KICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBXcml0ZS1FcnJvciAiVW5hYmxlIHRvIGZpbmQgZGVzdGluYXRpb24gZGlyZWN0b3J5OiBgJyREZXN0aW5hdGlvbmAnIgogICAgfQoKICAgICNlbmRyZWdpb24gTWFpbgoKICAgICNyZWdpb24gUG9zdENoZWNrCiAgICBpZiAoJFBlcmZvcm1Qb3N0Q2hlY2spIHsKICAgICAgICAkTmFtZSA9ICdQb3N0LUNoZWNrJwogICAgICAgICRGaWxlRXhpc3RzID0gVGVzdC1QYXRoICRQb3N0Q2hlY2tGaWxlTmFtZQogICAgICAgIFN3aXRjaCAoJFBvc3RDaGVja0FjdGlvbikgewogICAgICAgICAgICAnSWYgZmlsZSBleGlzdHMgdGhlbiBTdWNjZXNzJyB7IGlmICgkRmlsZUV4aXN0cykgeyBXcml0ZS1PdXRwdXQgIlN1Y2Nlc3NmdWwgZm9yICROYW1lICckUG9zdENoZWNrQWN0aW9uJyIgfSBlbHNlIHsgV3JpdGUtT3V0cHV0ICJGYWlsZWQgZm9yICROYW1lICckUG9zdENoZWNrQWN0aW9uJyIgfSB9CiAgICAgICAgICAgICdJZiBmaWxlIGRvZXMgbm90IGV4aXN0cyB0aGVuIFN1Y2Nlc3MnIHsgaWYgKC1ub3QgJEZpbGVFeGlzdHMpIHsgV3JpdGUtT3V0cHV0ICJTdWNjZXNzZnVsIGZvciAkTmFtZSAnJFBvc3RDaGVja0FjdGlvbiciIH0gZWxzZSB7IFdyaXRlLU91dHB1dCAiRmFpbGVkIGZvciAkTmFtZSAnJFBvc3RDaGVja0FjdGlvbiciIH0gfQogICAgICAgICAgICAnSWYgZmlsZSBleGlzdHMgdGhlbiBGYWlsJyB7IGlmICgkRmlsZUV4aXN0cykgeyBXcml0ZS1PdXRwdXQgIkZhaWxlZCBmb3IgJE5hbWUgJyRQb3N0Q2hlY2tBY3Rpb24nIiB9IGVsc2UgeyBXcml0ZS1PdXRwdXQgIlN1Y2Nlc3NmdWwgZm9yICROYW1lICckUG9zdENoZWNrQWN0aW9uJyIgfSB9CiAgICAgICAgICAgICdJZiBmaWxlIGRvZXMgbm90IGV4aXN0cyB0aGVuIEZhaWwnIHsgaWYgKC1ub3QgJEZpbGVFeGlzdHMpIHsgV3JpdGUtT3V0cHV0ICJGYWlsZWQgZm9yICROYW1lICckUG9zdENoZWNrQWN0aW9uJyIgfSBlbHNlIHsgV3JpdGUtT3V0cHV0ICJTdWNjZXNzZnVsIGZvciAkTmFtZSAnJFBvc3RDaGVja0FjdGlvbiciIH0gfQogICAgICAgICAgICAnSWYgZmlsZSBleGlzdHMgYW5kIE1ENSBjaGVja3N1bSBtYXRjaGVzIHRoZW4gU3VjY2VzcycgeyAKICAgICAgICAgICAgICAgIGlmICgkUG9zdENoZWNrTUQ1Q2hlY2tzdW0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJEZpbGVFeGlzdHMgLWFuZCAoKEdldC1NRDVIYXNoICRQb3N0Q2hlY2tGaWxlTmFtZSkgLWVxICRQb3N0Q2hlY2tNRDVDaGVja3N1bSkpIHsgV3JpdGUtT3V0cHV0ICJTdWNjZXNzZnVsIGZvciAkTmFtZSAnJFBvc3RDaGVja0FjdGlvbiciIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsgV3JpdGUtT3V0cHV0ICJGYWlsZWQgZm9yICROYW1lICckUG9zdENoZWNrQWN0aW9uJyIgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7IFdyaXRlLUVycm9yICJQbGVhc2UgcHJvdmlkZSBhIE1ENSBDaGVja3N1bSB0byB2YWxpZGF0ZSB0aGUgJE5hbWUgY29uZGl0aW9uIiB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJ0lmIGZpbGUgZXhpc3RzIGFuZCBNRDUgY2hlY2tzdW0gZG9lcyBub3QgbWF0Y2hlcyB0aGVuIFN1Y2Nlc3MnIHsgCiAgICAgICAgICAgICAgICBpZiAoJFBvc3RDaGVja01ENUNoZWNrc3VtKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRGaWxlRXhpc3RzIC1hbmQgISgoR2V0LU1ENUhhc2ggJFBvc3RDaGVja0ZpbGVOYW1lKSAtZXEgJFBvc3RDaGVja01ENUNoZWNrc3VtKSkgeyBXcml0ZS1PdXRwdXQgIlN1Y2Nlc3NmdWwgZm9yICROYW1lICckUG9zdENoZWNrQWN0aW9uJyIgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgeyBXcml0ZS1PdXRwdXQgIkZhaWxlZCBmb3IgJE5hbWUgJyRQb3N0Q2hlY2tBY3Rpb24nIiB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsgV3JpdGUtRXJyb3IgIlBsZWFzZSBwcm92aWRlIGEgTUQ1IENoZWNrc3VtIHRvIHZhbGlkYXRlIHRoZSAkTmFtZSBjb25kaXRpb24iIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAnSWYgZmlsZSBleGlzdHMgYW5kIE1ENSBjaGVja3N1bSBtYXRjaGVzIHRoZW4gRmFpbCcgeyAKICAgICAgICAgICAgICAgIGlmICgkUG9zdENoZWNrTUQ1Q2hlY2tzdW0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJEZpbGVFeGlzdHMgLWFuZCAoKEdldC1NRDVIYXNoICRQb3N0Q2hlY2tGaWxlTmFtZSkgLWVxICRQb3N0Q2hlY2tNRDVDaGVja3N1bSkpIHsgV3JpdGUtT3V0cHV0ICJGYWlsZWQgZm9yICROYW1lICckUG9zdENoZWNrQWN0aW9uJyIgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgeyBXcml0ZS1PdXRwdXQgIlN1Y2Nlc3NmdWwgZm9yICROYW1lICckUG9zdENoZWNrQWN0aW9uJyIgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7IFdyaXRlLUVycm9yICJQbGVhc2UgcHJvdmlkZSBhIE1ENSBDaGVja3N1bSB0byB2YWxpZGF0ZSB0aGUgJE5hbWUgY29uZGl0aW9uIiB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJ0lmIGZpbGUgZXhpc3RzIGFuZCBNRDUgY2hlY2tzdW0gZG9lcyBub3QgbWF0Y2hlcyB0aGVuIEZhaWwnIHsgCiAgICAgICAgICAgICAgICBpZiAoJFBvc3RDaGVja01ENUNoZWNrc3VtKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRGaWxlRXhpc3RzIC1hbmQgISgoR2V0LU1ENUhhc2ggJFBvc3RDaGVja0ZpbGVOYW1lKSAtZXEgJFBvc3RDaGVja01ENUNoZWNrc3VtKSkgeyBXcml0ZS1PdXRwdXQgIkZhaWxlZCBmb3IgJE5hbWUgJyRQb3N0Q2hlY2tBY3Rpb24nIiB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7IFdyaXRlLU91dHB1dCAiU3VjY2Vzc2Z1bCBmb3IgJE5hbWUgJyRQb3N0Q2hlY2tBY3Rpb24nIiB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsgV3JpdGUtRXJyb3IgIlBsZWFzZSBwcm92aWRlIGEgTUQ1IENoZWNrc3VtIHRvIHZhbGlkYXRlIHRoZSAkTmFtZSBjb25kaXRpb24iIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKICAgIH0KICAgICNlbmRyZWdpb24gUG9zdGNoZWNrCn0KY2F0Y2ggewogICAgV3JpdGUtT3V0cHV0ICJgbkZUUCBEb3dubG9hZCBGYWlsZWQiCiAgICBXcml0ZS1FcnJvciAkXy5FeGNlcHRpb24ubWVzc2FnZQp9Cg==","jsonSchema":{"additionalproperties":false,"dependencies":{"PerformPostCheck":{"oneOf":[{"additionalproperties":false,"properties":{"PerformPostCheck":{"enum":[true]},"PostCheckAction":{"enum":["If file exists then Success","If file does not exists then Success","If file exists then Fail","If file does not exists then Fail","If file exists and MD5 checksum matches then Success"],"title":"Action:","type":"string"},"PostCheckFileName":{"title":"File Name:","type":"string"},"PostCheckMD5Checksum":{"title":"MD5 checksum:","type":"string"}},"required":["PostCheckFileName"]},{"properties":{"PerformPostCheck":{"enum":[false]}}}]},"PerformPreCheck":{"oneOf":[{"additionalproperties":false,"dependencies":{"PreCheckType":{"oneOf":[{"properties":{"PreCheckAction":{"enum":["If file exists then Continue","If file does not exists then Continue","If file exists then Abort","If file does not exists then Abort","If file exists and MD5 checksum matches then Continue"],"title":"Action","type":"string"},"PreCheckFileName":{"title":"File Name:","type":"string"},"PreCheckMD5Checksum":{"title":"MD5 checksum:","type":"string"},"PreCheckType":{"enum":["Check if file exists"]}},"required":["PreCheckFileName"]},{"properties":{"PreCheckAction":{"enum":["If key exists then Continue","If key does not exists then Continue","If key exists then Abort","If key not exists then Abort","If key exists and value matches then Continue","If key exists and value does not matches then Continue","If key exists and value matches then Abort","If key exists and value does not matches then Abort","If key exists and value exists and data matches then Continue","If key exists and value exists and data does not matches then Continue","If key exists and value exists and data matches then Abort","If key exists and value exists and data does not matches then Abort"],"title":"Action","type":"string"},"PreCheckData":{"title":"Data:","type":"string"},"PreCheckKey":{"title":"Key:","type":"string"},"PreCheckType":{"enum":["Check if registry information exists"]},"PreCheckValue":{"title":"Value:","type":"string"}},"required":["PreCheckKey"]},{"properties":{"PreCheckAction":{"enum":["If file exists and version equal to specified then Continue","If file exists and version not equal to specified then Continue","If file exists and version higher to specified then Continue","If file exists and version lower to specified then Continue","If file exists and version equal to specified then Abort","If file exists and version not equal to specified then Abort","If file exists and version higher to specified then Abort","If file exists and version lower to specified then Abort","If file does not exists then Abort"],"title":"Action","type":"string"},"PreCheckFileName":{"title":"File Name:","type":"string"},"PreCheckType":{"enum":["Check for file version"]},"PreCheckVersion":{"title":"File Version:","type":"string"}},"required":["PreCheckFileName"]}]}},"properties":{"PerformPreCheck":{"enum":[true]},"PreCheckType":{"enum":["Check if file exists","Check if registry information exists","Check for file version"],"title":"Type","type":"string"}}},{"properties":{"PerformPreCheck":{"enum":[false]}}}]}},"patternproperties":{"^PostCheckAction$":{},"^PostCheckFileName$":{},"^PostCheckMD5Checksum$":{},"^PreCheckAction$":{},"^PreCheckData$":{},"^PreCheckFileName$":{},"^PreCheckKey$":{},"^PreCheckMD5Checksum$":{},"^PreCheckType$":{},"^PreCheckValue$":{},"^PreCheckVersion$":{}},"properties":{"ConnectionPath":{"title":"FTP Connection","type":"string"},"CreateDestinationFolder":{"title":"Create Directory If Required","type":"boolean"},"Destination":{"title":"Destination Directory Path","type":"string"},"Password":{"title":"Password","type":"string"},"PerformPostCheck":{"title":"Perform post-download check","type":"boolean"},"PerformPreCheck":{"title":"Perform pre-download check","type":"boolean"},"Recurse":{"title":"Recursive Download","type":"boolean"},"Source":{"title":"Source Directory Path","type":"string"},"Type":{"enum":["Folder","File"],"enumNames":["Folder","File"],"title":"Select","type":"string"},"Username":{"title":"Username","type":"string"}},"required":["ConnectionPath","Username","Password","Source","Destination","Type"],"title":"FTP Server","type":"object"},"uiSchema":{"ConnectionPath":{"classNames":"col-sm-7","ui:autofocus":true,"ui:help":"e.g. ftp.itsupport247.net or 191.1.4.2"},"CreateDestinationFolder":{"classNames":"col-sm-4","ui:autofocus":true},"Destination":{"classNames":"col-sm-6","ui:autofocus":true},"Password":{"classNames":"col-sm-6","ui:widget":"password"},"PerformPostCheck":{"classNames":"col-sm-12","ui:autofocus":true},"PerformPreCheck":{"classNames":"col-sm-8","ui:autofocus":true},"PostCheckAction":{"classNames":"col-sm-6","ui:autofocus":true,"ui:placeholder":"Select"},"PostCheckFileName":{"classNames":"col-sm-6","ui:autofocus":true},"PostCheckMD5Checksum":{"classNames":"col-sm-8","ui:autofocus":true},"PreCheckAction":{"classNames":"col-sm-8","ui:autofocus":true,"ui:placeholder":"Select"},"PreCheckData":{"classNames":"col-sm-8","ui:autofocus":true},"PreCheckFileName":{"classNames":"col-sm-6","ui:autofocus":true},"PreCheckKey":{"classNames":"col-sm-8","ui:autofocus":true},"PreCheckMD5Checksum":{"classNames":"col-sm-8","ui:autofocus":true},"PreCheckType":{"classNames":"col-sm-7","ui:autofocus":true,"ui:placeholder":"Select"},"PreCheckValue":{"classNames":"col-sm-8","ui:autofocus":true},"PreCheckVersion":{"classNames":"col-sm-7","ui:autofocus":true},"Recurse":{"classNames":"col-sm-6","ui:autofocus":true},"Source":{"classNames":"col-sm-6","ui:autofocus":true},"Type":{"classNames":"col-sm-12","ui:options":{"inline":true},"ui:widget":"radio"},"Username":{"classNames":"col-sm-6","validationSchema":{"notEmpty":"Password","required":["Password"],"type":"requiredFieldsIfNotEmpty"}},"ui:order":["ConnectionPath","Username","Password","Type","Source","Destination","Recurse","CreateDestinationFolder","PerformPreCheck","PreCheckType","PreCheckFileName","PreCheckMD5Checksum","PreCheckKey","PreCheckValue","PreCheckData","PreCheckVersion","PreCheckAction","PerformPostCheck","PostCheckFileName","PostCheckMD5Checksum","PostCheckAction"]},"isHDScript":false}