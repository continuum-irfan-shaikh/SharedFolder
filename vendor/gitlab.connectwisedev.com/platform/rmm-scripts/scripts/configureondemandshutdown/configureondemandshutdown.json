{"id":"fe55ae69-65cf-11e9-9d18-00155d130b17","partnerId":"00000000-0000-0000-0000-000000000000","category":["Green Computing"],"description":"Script will shutdown the system after checking the conditions provided","engine":"powershell","engineMaxVersion":5,"expectedExecutionTimeSec":300,"failureMessage":"Executed with errors","successMessage":"Task Executed Successfully","internal":false,"name":"Configure On-demand Shutdown","tags":["Windows 7","Windows 10"],"sequence":true,"content":"CjwjCiAgICAuU2NyaXB0CiAgICBDb25maWd1cmUgb24tZGVtYW5kIHNodXRkb3duLgogICAgLkF1dGhvcgogICAgTmlyYXYgU2FjaG9yYQogICAgLkRlc2NyaXB0aW9uCiAgICBTY3JpcHQgd2lsbCBzaHV0ZG93biB0aGUgc3lzdGVtIGFmdGVyIGNoZWNraW5nIHRoZSBjb25kaXRpb25zIHByb3ZpZGVkCiAgICAuUmVxdWlyZW1lbnRzCiAgICBTY3JpcHQgc2hvdWxkIHJ1biB3aXRoIGFkbWluIHByaXZpbGVnZXMuCiM+CiMkc2h1dGRvd250eXBlID0gYXNrL25vdGlmeQoKPCNbc3RyaW5nXSRwcm9jZXNzbmFtZSA9ICJwb3dlcnNoZWxsIgpbYm9vbF0kZG9ub3Rpbml0aWF0ZSA9ICR0cnVlCltib29sXSRleGVjdXRlY21kID0gZXhlY3V0ZWNtZC9leGVjdXRlcHJvY2VzcwogICAgW3N0cmluZ10kY21kCiAgICBbc3RyaW5nXSRwcm9jZXNzID0gIm5vdGVwYWQuZXhlIgogICAgW3N0cmluZ10kcGFyYW1ldGVyCiAKCltzdHJpbmddJGRpc3BsYXltc2cgPSAiSGVsbG8iCiR0aW1lb3V0ID0gMTAKJHByb2Nlc3N0aW1lb3V0ID0gMSM+CgppZiAoJGVudjpQUk9DRVNTT1JfQVJDSElURVc2NDMyIC1lcSAiQU1ENjQiKSB7CiAgICBpZiAoJG15SW52b2NhdGlvbi5MaW5lKSB7CiAgICAgICAgJiIkZW52OnN5c3RlbXJvb3Rcc3lzbmF0aXZlXHdpbmRvd3Nwb3dlcnNoZWxsXHYxLjBccG93ZXJzaGVsbC5leGUiIC1Ob25JbnRlcmFjdGl2ZSAtTm9Qcm9maWxlICRteUludm9jYXRpb24uTGluZQogICAgfQogICAgZWxzZSB7CiAgICAgICAgJiIkZW52OnN5c3RlbXJvb3Rcc3lzbmF0aXZlXHdpbmRvd3Nwb3dlcnNoZWxsXHYxLjBccG93ZXJzaGVsbC5leGUiIC1Ob25JbnRlcmFjdGl2ZSAtTm9Qcm9maWxlIC1maWxlICIkKCRteUludm9jYXRpb24uSW52b2NhdGlvbk5hbWUpIiAkYXJncwogICAgfQogICAgZXhpdCAkbGFzdGV4aXRjb2RlCn0KCgpbaW50XSRjb25mCgokb3MgPSAoR2V0LVdNSU9iamVjdCBXaW4zMl9PcGVyYXRpbmdTeXN0ZW0pLkNhcHRpb24KaWYgKCRvcyAtbGlrZSAiKnNlcnZlcioiKSB7CiAgICAkbG9nZ2VkaW51c2VycyA9IChxdXNlcikgLXJlcGxhY2UgJ1xzezIsfScsICcsJwogICAgaWYgKCEkbG9nZ2VkaW51c2Vycy5jb3VudCkgewogICAgICAgIFdyaXRlLU91dHB1dCAiTm8gdXNlcnMgYXJlIGxvZ2dlZCBvbiB0byB0aGlzIHN5c3RlbS4iCiAgICAgICAgRXhpdDsKICAgIH0KICAgIGVsc2VpZiAoJGxvZ2dlZGludXNlcnMuY291bnQgLWd0IDIpIHsKICAgICAgICBXcml0ZS1PdXRwdXQgIk11bHRpcGxlIHVzZXJzIGFyZSBsb2dnZWQgb24gdG8gdGhpcyBtYWNoaW5lLmBuV2luZG93cyBjYW5ub3QgYmUgc2h1dGRvd24uIgogICAgICAgIEV4aXQ7CiAgICB9Cn0KCmlmICgkdGltZW91dCAtZ3QgMzApIHsKICAgIFdyaXRlLUVycm9yICJNYXhpbXVtIHRpbWVvdXQgYWxsb3dlZCBpcyAzMCBtaW51dGVzIgogICAgRXhpdDsKfQoKaWYgKCRwcm9jZXNzbmFtZSAtbmUgJG51bGwpIHsKICAgICRwcm9jZXNzZGV0YWlscyA9IEdldC1Qcm9jZXNzIC1OYW1lICRwcm9jZXNzbmFtZSAtRXJyb3JBY3Rpb24gIlNpbGVudGx5Q29udGludWUiCiAgICBpZiAoJHByb2Nlc3NkZXRhaWxzIC1uZSAkbnVsbCkgewogICAgICAgIGlmICgkZG9ub3Rpbml0aWF0ZSAtZXEgJHRydWUpIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICIkcHJvY2Vzc25hbWUgaXMgcnVubmluZyBpbiB0aGUgbWVtb3J5YG5gbldpbmRvd3MgY2Fubm90IGJlIHNodXRkb3duLiIKICAgICAgICAgICAgRXhpdDsKICAgICAgICB9CiAgICAgICAgZWxzZWlmICgkZXhlY3V0ZWNtZCAtZXEgImV4ZWN1dGVjbWQiKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAkcGluZm8gPSBOZXctT2JqZWN0IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzU3RhcnRJbmZvCiAgICAgICAgICAgICAgICAkcGluZm8uRmlsZU5hbWUgPSAiJGNtZCIKICAgICAgICAgICAgICAgICRwaW5mby5SZWRpcmVjdFN0YW5kYXJkRXJyb3IgPSAkdHJ1ZQogICAgICAgICAgICAgICAgJHBpbmZvLlJlZGlyZWN0U3RhbmRhcmRPdXRwdXQgPSAkdHJ1ZQogICAgICAgICAgICAgICAgJHBpbmZvLlVzZVNoZWxsRXhlY3V0ZSA9ICRmYWxzZQogICAgICAgICAgICAgICAgaWYgKCEkcGFyYW1ldGVyKSB7CiAgICAgICAgICAgICAgICAgICAgJHBpbmZvLkFyZ3VtZW50cyA9ICIkcGFyYW1ldGVyIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHAgPSBOZXctT2JqZWN0IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzCiAgICAgICAgICAgICAgICAkcC5TdGFydEluZm8gPSAkcGluZm8KICAgICAgICAgICAgICAgICRFcnJvckFjdGlvblByZWZlcmVuY2UgPSAiU3RvcCIKICAgICAgICAgICAgICAgICRwLlN0YXJ0KCkKICAgICAgICAgICAgICAgICRFcnJvckFjdGlvblByZWZlcmVuY2UgPSAiQ29udGludWUiCiAgICAgICAgICAgICAgICBpZiAoISR0aW1lKSB7ICRleGl0c3RhdHVzID0gJHAuV2FpdEZvckV4aXQoKSB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkZXhpdHRpbWUgPSAkcHJvY2Vzc3RpbWVvdXQgKiA2MDAwMAogICAgICAgICAgICAgICAgICAgICRleGl0c3RhdHVzID0gJHAuV2FpdEZvckV4aXQoJGV4aXR0aW1lKQogICAgICAgICAgICAgICAgICAgIGlmICgkZXhpdHN0YXR1cykgeyAkY29uZiA9IDEgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgeyAkcC5LaWxsKCkgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLUVycm9yICJQcm9jZXNzIGNvdWxkIG5vdCBiZSBzdGFydGVkIgogICAgICAgICAgICAgICAgRXhpdDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKZWxzZWlmICgkY29uZiAtZXEgMSkgewogICAgJHdzaGVsbCA9IE5ldy1PYmplY3QgLUNvbU9iamVjdCBXc2NyaXB0LlNoZWxsIC1FcnJvckFjdGlvbiBTdG9wCiAgICBpZiAoJHNodXRkb3dudHlwZSAtZXEgImFzayIpIHsKICAgICAgICAkdXNlcmlucHV0ID0gJHdzaGVsbC5Qb3B1cCgiJGRpc3BsYXltc2dgblBvcC11cCB3aWxsIGF1dG8gY2xvc2UgYWZ0ZXIgJHRpbWVvdXQgbWludXRlcyAiLCAkdGltZW91dCAqIDYwLCAiU2h1dGRvd24gQ29uZmlybWF0aW9uIiwgMzIgKyAxKQogICAgICAgIHN3aXRjaCAoJHVzZXJpbnB1dCkgewogICAgICAgICAgICAxIHsgU3RvcC1Db21wdXRlciB9CiAgICAgICAgICAgIDIgeyBXcml0ZS1PdXRwdXQgIlVzZXIgaGFzIGRlY2xpbmVkIHRoZSByZXF1ZXN0IHRvIHNodXRkb3duIGNvbXB1dGVyLiI7IEV4aXQ7IH0KICAgICAgICAgICAgLTEgeyBXcml0ZS1PdXRwdXQgIk5vIENvbmZpcm1hdGlvbiBmcm9tIHVzZXIuIjsgRXhpdDsgfQogICAgICAgIH0KICAgIH0KICAgIGlmICgkc2h1dGRvd250eXBlIC1lcSAibm90aWZ5IikgewogICAgICAgICR1c2VyaW5wdXQgPSAkd3NoZWxsLlBvcHVwKCIkZGlzcGxheW1zZ2BuYG5QcmVzcyBPSyBvciBDbG9zZSB0aGUgZGlhbG9ndWUgYm94IHRvIHNodXRkb3duYG5gblN5c3RlbSB3aWxsIGF1dG9tYXRpY2FsbHkgc2h1dGRvd24gYWZ0ZXIgJHRpbWVvdXQgbWludXRlcyIsICR0aW1lb3V0ICogNjAsICJTaHV0ZG93biBOb3RpZmljYXRpb24iLCA2NCArIDApCiAgICAgICAgc3dpdGNoICgkdXNlcmlucHV0KSB7CiAgICAgICAgICAgIDEgeyBTdG9wLUNvbXB1dGVyIH0KICAgICAgICAgICAgLTEgeyBTdG9wLUNvbXB1dGVyIH0KICAgICAgICB9CiAgICB9Cn0K","jsonSchema":{"type": "object","properties": {"shutdownType": {"type": "string","title": "If a user is logged on:","enum": ["ask","notify"],"enumNames": ["Ask the user for confirmation before initiating Shutdown","Notify the user that the machine will Shutdown"]},"displaymsg": {"title": "Display this Message:","type": "string"},"timeout":{"title":"Wait time before shutdown","type":"integer"},"Addprocess": {"title": "Add a Process","type": "boolean"}},"additionalproperties": false,"patterenproperties": {"^timeout$": {},"^processname$": {},"^cmd$": {},"^donotinitiate$": {},"^executecmd$": {},"^parameter$": {},"^processtimeout$": {},"^shutdownCondition$": {}},"dependencies": {"Addprocess": {"oneOf": [{"properties": {"Addprocess": {"enum": [true]},"processname": {"title": "If process is running in memory","type": "string"},"shutdownCondition": {"type": "string","title": " ","enum": ["donotinitiate","executecmd"],"enumNames": ["Do not initiate Shutdown","Execute the following commands and process the Shutdown"]}},"dependencies": {"shutdownCondition": {"oneOf": [{"properties": {"shutdownCondition": {"enum": ["donotinitiate"]}}},{"properties": {"shutdownCondition": {"enum": ["executecmd"]},"cmd": {"title": "Command/Process","type": "string"},"parameter": {"title": "Parameter","type": "string"},"processtimeout": {"title": "Process Timeout","type": "integer"}}}]}}}]}}},"uiSchema":{"shutdownType":{"classNames":"col-sm-12","ui:widget": "radio","ui:options": {"inline": true}},"displaymsg":{"classNames": "col-sm-12","ui:autofocus": true,"ui:help": "Input Message","ui:widget": "textarea","ui:options": {"rows": 5}},"timeout":{"classNames":"col-sm-4","ui:autofocus":true,"ui:help":"Seconds"},"Addprocess":{"classNames":"col-sm-12","ui:autofocus":true},"processname":{"classNames":"col-sm-12","ui:autofocus":true},"shutdownCondition":{"classNames":"col-sm-12","ui:widget": "radio","ui:options": {"inline": true}},"cmd":{"classNames":"col-sm-6","ui:autofocus":true},"parameter":{"classNames":"col-sm-6","ui:autofocus":true},"processtimeout":{"classNames":"col-sm-3","ui:autofocus":true,"ui:help":"Minutes"},"ui:order":["shutdownType","displaymsg","timeout","Addprocess","processname","shutdownCondition","cmd","parameter","processtimeout"]},"isHDScript":false}
