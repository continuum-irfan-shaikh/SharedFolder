#$action = "uninstall"
#$restart = $true/$false
<#
    .Script
    Uninstall Malwarebytes from the system.
    .Author
    Nirav Sachora
    .Description
    Script will uninstall Malware bytes antivirus software from the system.
    .Requirements
    Script should run with admin privileges.
#>

if ($env:PROCESSOR_ARCHITEW6432 -eq "AMD64") {
    if ($myInvocation.Line) {
        &"$env:systemroot\sysnative\windowspowershell\v1.0\powershell.exe" -NonInteractive -NoProfile $myInvocation.Line
    }
    else {
        &"$env:systemroot\sysnative\windowspowershell\v1.0\powershell.exe" -NonInteractive -NoProfile -file "$($myInvocation.InvocationName)" $args
    }
    exit $lastexitcode
}

    Function Execute_process($path) {
        $pinfo = New-Object System.Diagnostics.ProcessStartInfo
        $pinfo.FileName = "$path"
        $pinfo.RedirectStandardError = $true
        $pinfo.RedirectStandardOutput = $true
        $pinfo.UseShellExecute = $false
        $pinfo.Arguments = "/verysilent /suppressmsgboxes /norestart"
        $p = New-Object System.Diagnostics.Process
        $p.StartInfo = $pinfo
        $p.Start() | Out-Null
        $p.WaitForExit()
        return $p.ExitCode
    }

    function OS_bit_check {
        $bits = Get-WmiObject -Class win32_Operatingsystem |Select -ExpandProperty OSArchitecture
        return $bits
    }

    if ((OS_bit_check) -eq "32-bit") {
        $path = "C:\Program Files\malwarebytes anti-malware\unins000.exe"
    }
    elseif ((OS_bit_check) -eq "64-bit") {
        $path = "C:\Program Files (x86)\malwarebytes anti-malware\unins000.exe"
    }

    if ((Test-path $path) -eq $false) {
        Write-Output "Malwarebytes is not installed on this system"
        Exit;
    }

    $Uninstall_result = Execute_process -path $path

    if ($Uninstall_result -eq 0) {
        Write-Output "Malwarebytes has been uninstalled from the system."
            if($restart -eq $true){
                Restart-Computer -Force
            }
    }
    Else {
        Write-Error "Failed to uninstall malwarebytes from the system"
    }



