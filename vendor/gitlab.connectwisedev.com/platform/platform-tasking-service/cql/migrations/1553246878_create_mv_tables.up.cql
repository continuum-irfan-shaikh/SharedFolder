CREATE TABLE IF NOT EXISTS platform_tasking_db.task_by_runtime_unix_mv (
    partner_id text,
    external_task boolean,
    managed_endpoint_id uuid,
    id uuid,
    created_at timestamp,
    created_by text,
    definition_id uuid,
    description text,
    end_run_time timestamp,
    iteration_ids frozen<set<uuid>>,
    last_task_instance_id uuid,
    location text,
    modified_at timestamp,
    modified_by text,
    name text,
    old_schedule text,
    origin_id uuid,
    original_next_run_time timestamp,
    parameters text,
    regularity int,
    require_noc_access boolean,
    result_webhook text,
    run_time timestamp,
    run_time_unix timestamp,
    schedule text,
    start_run_time timestamp,
    state int,
    target_type int,
    targets set<text>,
    trigger text,
    type text,
    PRIMARY KEY (partner_id, external_task, run_time_unix, managed_endpoint_id, id)
);


CREATE TABLE IF NOT EXISTS platform_tasking_db.tasks_order_by_last_task_instance_id_mv (
    partner_id text,
    external_task boolean,
    managed_endpoint_id uuid,
    id uuid,
    created_at timestamp,
    created_by text,
    definition_id uuid,
    description text,
    end_run_time timestamp,
    iteration_ids frozen<set<uuid>>,
    last_task_instance_id uuid,
    location text,
    modified_at timestamp,
    modified_by text,
    name text,
    old_schedule text,
    origin_id uuid,
    original_next_run_time timestamp,
    parameters text,
    regularity int,
    require_noc_access boolean,
    result_webhook text,
    run_time timestamp,
    run_time_unix timestamp,
    schedule text,
    start_run_time timestamp,
    state int,
    target_type int,
    targets set<text>,
    trigger text,
    type text,
    PRIMARY KEY ((partner_id, managed_endpoint_id, external_task), last_task_instance_id, id)
);


CREATE TABLE IF NOT EXISTS platform_tasking_db.tasks_by_runtime_mv (
    partner_id text,
    external_task boolean,
    managed_endpoint_id uuid,
    id uuid,
    created_at timestamp,
    created_by text,
    definition_id uuid,
    description text,
    end_run_time timestamp,
    iteration_ids frozen<set<uuid>>,
    last_task_instance_id uuid,
    location text,
    modified_at timestamp,
    modified_by text,
    name text,
    old_schedule text,
    origin_id uuid,
    original_next_run_time timestamp,
    parameters text,
    regularity int,
    require_noc_access boolean,
    result_webhook text,
    run_time timestamp,
    run_time_unix timestamp,
    schedule text,
    start_run_time timestamp,
    state int,
    target_type int,
    targets set<text>,
    trigger text,
    type text,
    PRIMARY KEY (run_time_unix, id, partner_id, managed_endpoint_id, external_task)
);

CREATE TABLE IF NOT EXISTS platform_tasking_db.tasks_by_id_mv (
    partner_id text,
    external_task boolean,
    managed_endpoint_id uuid,
    id uuid,
    created_at timestamp,
    created_by text,
    definition_id uuid,
    description text,
    end_run_time timestamp,
    iteration_ids frozen<set<uuid>>,
    last_task_instance_id uuid,
    location text,
    modified_at timestamp,
    modified_by text,
    name text,
    old_schedule text,
    origin_id uuid,
    original_next_run_time timestamp,
    parameters text,
    regularity int,
    require_noc_access boolean,
    result_webhook text,
    run_time timestamp,
    run_time_unix timestamp,
    schedule text,
    start_run_time timestamp,
    state int,
    target_type int,
    targets set<text>,
    trigger text,
    type text,
    PRIMARY KEY ((partner_id, id), run_time_unix, managed_endpoint_id, external_task)
);