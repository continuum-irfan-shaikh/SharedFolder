//
// ATTENTION!!! DO NOT EDIT THIS FILE. IT IS CREATED FOLLOWING SCHEMA MIGRATION STRATEGY
//

DROP MATERIALIZED VIEW IF EXISTS tasks_by_runtime;
ALTER TABLE tasks DROP last_run_at;
ALTER TABLE tasks DROP started_at;
CREATE MATERIALIZED VIEW IF NOT EXISTS tasks_by_runtime AS
    SELECT *
    FROM tasks
    WHERE run_time_unix IS NOT NULL AND partner_id IS NOT NULL AND id IS NOT NULL AND managed_endpoint_id IS NOT NULL AND external_task IS NOT NULL
    PRIMARY KEY (run_time_unix, id, partner_id, managed_endpoint_id, external_task);


DROP MATERIALIZED VIEW IF EXISTS task_instances_by_id;
ALTER TABLE task_instances DROP created_at;
CREATE MATERIALIZED VIEW IF NOT EXISTS task_instances_by_id AS
    SELECT id, task_id, origin_id, targets, started_at, status
    FROM task_instances
    WHERE id IS NOT NULL AND task_id IS NOT NULL AND started_at IS NOT NULL
    PRIMARY KEY (id, task_id, started_at);
