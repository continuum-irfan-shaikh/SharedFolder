//
// ATTENTION!!! DO NOT EDIT THIS FILE. IT IS CREATED FOLLOWING SCHEMA MIGRATION STRATEGY
//

DROP MATERIALIZED VIEW IF EXISTS tasks_by_runtime;
DROP MATERIALIZED VIEW IF EXISTS tasks_order_by_last_task_instance_id;
DROP MATERIALIZED VIEW IF EXISTS tasks_by_id_managed_endpoint_id;
DROP MATERIALIZED VIEW IF EXISTS tasks_by_id;

ALTER TABLE tasks DROP last_task_instance_id;

CREATE MATERIALIZED VIEW IF NOT EXISTS tasks_by_runtime AS
    SELECT *
    FROM tasks
    WHERE run_time_unix IS NOT NULL AND partner_id IS NOT NULL AND id IS NOT NULL AND managed_endpoint_id IS NOT NULL AND external_task IS NOT NULL
    PRIMARY KEY (run_time_unix, id, partner_id, managed_endpoint_id, external_task);

CREATE MATERIALIZED VIEW IF NOT EXISTS tasks_by_id AS
    SELECT *
    FROM tasks
    WHERE partner_id IS NOT NULL AND id IS NOT NULL AND managed_endpoint_id IS NOT NULL AND external_task IS NOT NULL
    PRIMARY KEY ((partner_id, id), managed_endpoint_id, external_task);

CREATE MATERIALIZED VIEW IF NOT EXISTS tasks_by_id_managed_endpoint_id AS
    SELECT *
    FROM tasks
    WHERE partner_id IS NOT NULL AND id IS NOT NULL AND managed_endpoint_id IS NOT NULL AND external_task IS NOT NULL
    PRIMARY KEY ((partner_id, id, managed_endpoint_id), external_task);
